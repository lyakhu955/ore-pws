<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Ore PWS Group (Modern)</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Applicazione per la gestione delle ore di lavoro - Ore PWS Group">
    <meta name="keywords" content="ore lavoro, timesheet, gestione tempo, PWS Group">
    <meta name="author" content="PWS Group">
    <meta name="robots" content="index, follow">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Ore PWS Group - Gestione Ore di Lavoro">
    <meta property="og:description" content="Applicazione moderna per la gestione delle ore di lavoro con sincronizzazione cloud">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://i.imgur.com/BnllByD.png">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Ore PWS Group - Gestione Ore di Lavoro">
    <meta name="twitter:description" content="Applicazione moderna per la gestione delle ore di lavoro">
    <meta name="twitter:image" content="https://i.imgur.com/BnllByD.png">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#006A6A">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ore PWS">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Ore PWS">

    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="./icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="./icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="./icons/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="114x114" href="./icons/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="76x76" href="./icons/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="72x72" href="./icons/icon-72x72.png">
    <link rel="apple-touch-icon" href="./icons/icon-192x192.png">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="./icons/icon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./icons/icon-72x72.png">
    <link rel="shortcut icon" href="./icons/icon-96x96.png">

    <!-- Dynamic Canonical URL -->
    <script>
        // Set canonical URL dynamically based on current domain
        const canonicalUrl = window.location.origin + window.location.pathname;
        const canonicalLink = document.createElement('link');
        canonicalLink.rel = 'canonical';
        canonicalLink.href = canonicalUrl;
        document.head.appendChild(canonicalLink);

        // Set Open Graph URL dynamically
        const ogUrlMeta = document.createElement('meta');
        ogUrlMeta.property = 'og:url';
        ogUrlMeta.content = canonicalUrl;
        document.head.appendChild(ogUrlMeta);
    </script>
    <!-- Google Fonts: Roboto and Material Symbols Outlined -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <!-- Include Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        /* Material Design 3 Inspired Theme - Android 2025 */

        /* iOS Safari Compatibility Fixes */
        html {
            height: 100%;
            height: -webkit-fill-available;
        }

        body {
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }

        /* Safe Area Support for iOS */
        @supports (padding: max(0px)) {
            body {
                padding-left: env(safe-area-inset-left, 0px);
                padding-right: env(safe-area-inset-right, 0px);
                padding-top: env(safe-area-inset-top, 0px);
            }

            header {
                padding-top: calc(0.75rem + env(safe-area-inset-top, 0px));
                padding-left: calc(1rem + env(safe-area-inset-left, 0px));
                padding-right: calc(1rem + env(safe-area-inset-right, 0px));
            }

            main {
                margin-top: calc(70px + env(safe-area-inset-top, 0px));
            }

            .bottom-nav {
                padding-bottom: calc(0.5rem + env(safe-area-inset-bottom, 0px));
                padding-left: env(safe-area-inset-left, 0px);
                padding-right: env(safe-area-inset-right, 0px);
            }


        }

        /* iOS Touch Optimization */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        button, .btn, .button, [role="button"] {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

        /* iOS Scroll Optimization */
        .scrollable, .modal-content, .calendar-container {
            -webkit-overflow-scrolling: touch;
        }

        /* Additional Webkit Prefixes for iOS Safari */
        .card, .modal, .bottom-nav {
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }

        input, select, textarea {
            -webkit-appearance: none;
            -webkit-border-radius: 0;
        }

        /* iOS Safari Animation Optimization */
        .fade-in {
            -webkit-animation: fadeIn 0.3s ease-out;
            animation: fadeIn 0.3s ease-out;
        }

        /* iOS Safari Scroll Bounce Fix */
        body {
            overscroll-behavior: none;
            -webkit-overflow-scrolling: touch;
        }

        /* iOS Safari Input Focus Fix */
        input, textarea, select {
            font-size: 16px; /* Prevents zoom on focus in iOS Safari */
        }

        @media screen and (max-width: 768px) {
            input, textarea, select {
                font-size: 16px !important; /* Force 16px on mobile to prevent zoom */
            }
        }

        /* Override existing body padding for safe area compatibility */
        body {
            padding-bottom: calc(80px + env(safe-area-inset-bottom, 0px)) !important;
        }

        :root {
            /* Light Theme Palette (Material You - Teal/Blue Base) */
            --md-sys-color-primary: #006A6A;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #9DF2F1;
            --md-sys-color-on-primary-container: #002020;
            --md-sys-color-secondary: #4A6363;
            --md-sys-color-on-secondary: #FFFFFF;
            --md-sys-color-secondary-container: #CCE8E7;
            --md-sys-color-on-secondary-container: #051F1F;
            --md-sys-color-tertiary: #4B607C;
            --md-sys-color-on-tertiary: #FFFFFF;
            --md-sys-color-tertiary-container: #D3E4FF;
            --md-sys-color-on-tertiary-container: #041C35;
            --md-sys-color-error: #BA1A1A;
            --md-sys-color-on-error: #FFFFFF;
            --md-sys-color-error-container: #FFDAD6;
            --md-sys-color-on-error-container: #410002;
            --md-sys-color-background: #FAFDFC;
            --md-sys-color-on-background: #191C1C;
            --md-sys-color-surface: #FAFDFC;
            --md-sys-color-on-surface: #191C1C;
            --md-sys-color-surface-variant: #DAE5E4;
            --md-sys-color-on-surface-variant: #3F4948;
            --md-sys-color-outline: #6F7979;
            --md-sys-color-outline-variant: #BFC9C8;
            --md-sys-color-shadow: #000000;
            --md-sys-color-scrim: #000000;
            --body-font-family: 'Roboto', sans-serif;
            --base-font-size: 16px;
            --border-radius-small: 8px;
            --border-radius-medium: 12px;
            --border-radius-large: 16px;
            --border-radius-full: 999px;
            --elevation-1: 0px 1px 2px rgba(0, 0, 0, 0.3), 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
            --elevation-2: 0px 1px 2px rgba(0, 0, 0, 0.3), 0px 2px 6px 2px rgba(0, 0, 0, 0.15);
            --elevation-3: 0px 4px 8px 3px rgba(0, 0, 0, 0.15), 0px 1px 3px rgba(0, 0, 0, 0.3);
            --elevation-4: 0px 6px 10px 4px rgba(0, 0, 0, 0.15), 0px 2px 3px rgba(0, 0, 0, 0.3);
            --elevation-5: 0px 8px 12px 6px rgba(0, 0, 0, 0.15), 0px 4px 4px rgba(0, 0, 0, 0.3);
        }

        /* Dark Theme Palette */
        .dark-theme {
            --md-sys-color-primary: #81D5D4;
            --md-sys-color-on-primary: #003737;
            --md-sys-color-primary-container: #00504F;
            --md-sys-color-on-primary-container: #9DF2F1;
            --md-sys-color-secondary: #B0CCCB;
            --md-sys-color-on-secondary: #1C3534;
            --md-sys-color-secondary-container: #334B4B;
            --md-sys-color-on-secondary-container: #CCE8E7;
            --md-sys-color-tertiary: #B3C8E8;
            --md-sys-color-on-tertiary: #1D314B;
            --md-sys-color-tertiary-container: #344863;
            --md-sys-color-on-tertiary-container: #D3E4FF;
            --md-sys-color-error: #FFB4AB;
            --md-sys-color-on-error: #690005;
            --md-sys-color-error-container: #93000A;
            --md-sys-color-on-error-container: #FFDAD6;
            --md-sys-color-background: #191C1C;
            --md-sys-color-on-background: #E0E3E2;
            --md-sys-color-surface: #191C1C;
            --md-sys-color-on-surface: #E0E3E2;
            --md-sys-color-surface-variant: #3F4948;
            --md-sys-color-on-surface-variant: #BFC9C8;
            --md-sys-color-outline: #899392;
            --md-sys-color-outline-variant: #3F4948;
            /* Shadow and Scrim remain black */
            --md-sys-color-inverse-surface: #E0E3E2;
            --md-sys-color-inverse-on-surface: #191C1C;
            --md-sys-color-inverse-primary: #006A6A;
        }

        /* Global Styles */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: var(--base-font-size);
        }

        body {
            font-family: var(--body-font-family);
            background-color: var(--md-sys-color-background);
            color: var(--md-sys-color-on-background);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding-bottom: 80px; /* Space for bottom nav */
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* Header */
        header {
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            box-shadow: var(--elevation-1);
            padding: 0.75rem 1rem;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo img {
            max-height: 40px; /* Adjusted logo size */
            width: auto;
            display: block;
        }

        /* Animazione logo rimbalzante */
        @keyframes bounce-horizontal {
            0%, 100% {
                transform: translateX(0) rotate(0deg);
                animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
            }
            25% {
                transform: translateX(15px) rotate(5deg);
                animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
            }
            50% {
                transform: translateX(0) rotate(0deg);
                animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
            }
            75% {
                transform: translateX(-15px) rotate(-5deg);
                animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
            }
        }

        .bouncing-logo {
            animation: bounce-horizontal 2s infinite;
            transform-origin: center;
            cursor: pointer;
            transition: filter 0.3s ease;
        }

        .bouncing-logo:hover {
            filter: drop-shadow(0 0 5px var(--md-sys-color-primary));
            animation-play-state: paused;
        }

        /* Animazione più vivace quando l'utente clicca sul logo */
        @keyframes bounce-excited {
            0%, 100% {
                transform: translateX(0) rotate(0deg) scale(1);
                animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
            }
            10% {
                transform: translateX(20px) rotate(10deg) scale(1.2);
            }
            20% {
                transform: translateX(-20px) rotate(-15deg) scale(1.1);
            }
            30% {
                transform: translateX(15px) rotate(15deg) scale(1.15);
            }
            40% {
                transform: translateX(-15px) rotate(-10deg) scale(1.05);
            }
            50% {
                transform: translateY(-15px) rotate(5deg) scale(1.1);
            }
            60% {
                transform: translateY(10px) rotate(-5deg) scale(1.05);
            }
            70% {
                transform: translateX(20px) translateY(-5px) rotate(10deg) scale(1.1);
            }
            80% {
                transform: translateX(-20px) translateY(5px) rotate(-10deg) scale(1.05);
            }
            90% {
                transform: translateX(10px) translateY(-3px) rotate(5deg) scale(1.02);
            }
        }

        .bouncing-logo-excited {
            animation: bounce-excited 2s ease-in-out;
            transform-origin: center;
            cursor: pointer;
            filter: drop-shadow(0 0 8px var(--md-sys-color-primary));
        }

        /* Removed troll button styles */

        main {
            padding: 1rem;
            margin-top: 70px; /* Adjusted for header height */
        }

        /* Card */
        .card {
            background-color: var(--md-sys-color-surface-variant); /* Slightly different bg */
            color: var(--md-sys-color-on-surface-variant);
            border-radius: var(--border-radius-large);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--elevation-1);
            border: 1px solid var(--md-sys-color-outline-variant);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        .card h2, .card h3 {
            color: var(--md-sys-color-primary);
            margin-bottom: 1rem;
            font-weight: 500;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.25rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
            color: var(--md-sys-color-on-surface-variant);
        }

        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="tel"],
        textarea,
        select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid var(--md-sys-color-outline);
            border-radius: var(--border-radius-small);
            font-size: 1rem;
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            appearance: none; /* For select */
            -webkit-appearance: none;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 2px var(--md-sys-color-primary-container);
        }

        select {
             /* Add arrow for select */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 -960 960 960' width='24'%3E%3Cpath d='M480-345 240-585l56-56 184 184 184-184 56 56-240 240Z' fill='%23${(getComputedStyle(document.documentElement).getPropertyValue('--md-sys-color-on-surface').trim() || '#191C1C').substring(1)}'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.5em;
            padding-right: 3rem; /* Space for arrow */
        }
        .dark-theme select {
             background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 -960 960 960' width='24'%3E%3Cpath d='M480-345 240-585l56-56 184 184 184-184 56 56-240 240Z' fill='%23${(getComputedStyle(document.documentElement).getPropertyValue('--md-sys-color-on-surface').trim() || '#E0E3E2').substring(1)}'/%3E%3C/svg%3E");
        }


        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group-inline {
            flex: 1;
            min-width: 120px;
        }

        /* Buttons */
        button, .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius-full); /* Pill shape */
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.1s ease;
            box-shadow: var(--elevation-1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        button:hover, .btn:hover {
            box-shadow: var(--elevation-2);
        }

        button:active, .btn:active {
            transform: scale(0.98);
            box-shadow: none;
        }

        /* Filled Button (Primary Action) */
        button[type="submit"], #submitBtn, #saveUserName, #addVehicle, #exportData, #importData, #saveFerieMalattie, .export-btn, .edit-all-btn, #addEntryBtn {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
        }
        button[type="submit"]:hover, #submitBtn:hover, #saveUserName:hover, #addVehicle:hover, #exportData:hover, #importData:hover, #saveFerieMalattie:hover, .export-btn:hover, .edit-all-btn:hover, #addEntryBtn:hover {
             /* Slightly darker/lighter on hover - generate this if needed */
            filter: brightness(90%);
        }
        .dark-theme button[type="submit"]:hover, .dark-theme #submitBtn:hover, .dark-theme #saveUserName:hover, .dark-theme #addVehicle:hover, .dark-theme #exportData:hover, .dark-theme #importData:hover, .dark-theme #saveFerieMalattie:hover, .dark-theme .export-btn:hover, .dark-theme .edit-all-btn:hover, .dark-theme #addEntryBtn:hover {
            filter: brightness(110%);
        }

        /* Error/Destructive Button */
        #clearData, .delete-btn, .delete-ferie-btn, .delete-vehicle-btn {
            background-color: var(--md-sys-color-error);
            color: var(--md-sys-color-on-error);
        }
         #clearData:hover, .delete-btn:hover, .delete-ferie-btn:hover, .delete-vehicle-btn:hover {
            filter: brightness(90%);
        }
        .dark-theme #clearData:hover, .dark-theme .delete-btn:hover, .dark-theme .delete-ferie-btn:hover, .dark-theme .delete-vehicle-btn:hover {
            filter: brightness(110%);
        }


        /* Text Button (e.g., Cancel) */
        .form-buttons button:last-child, .close-modal {
             background-color: transparent;
             color: var(--md-sys-color-primary);
             box-shadow: none;
        }
         .form-buttons button:last-child:hover, .close-modal:hover {
            background-color: var(--md-sys-color-primary-container);
         }
        .close-modal { /* Specific style for modal close */
             font-size: 1.75rem;
             padding: 0.5rem;
             border-radius: 50%;
             line-height: 1;
             color: var(--md-sys-color-on-surface-variant);
             font-weight: normal;
             border: none; /* Ensure no border */
        }
        .close-modal:hover {
            color: var(--md-sys-color-on-primary-container);
        }


        /* Small Action Buttons (Edit/Delete in lists) */
        .edit-btn, .delete-btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            min-width: 36px;
            min-height: 36px;
            box-shadow: none;
            border-radius: var(--border-radius-small);
            text-transform: none;
            letter-spacing: normal;
            border: 1px solid transparent; /* Base border */
        }
        .edit-btn { /* Make edit look like an Outlined Button */
            background-color: transparent;
            color: var(--md-sys-color-primary);
            border-color: var(--md-sys-color-outline);
        }
        .edit-btn:hover {
             background-color: var(--md-sys-color-primary-container);
             border-color: var(--md-sys-color-primary-container);
        }
        .delete-btn {
            background-color: var(--md-sys-color-error-container);
            color: var(--md-sys-color-on-error-container);
        }
        .delete-btn:hover {
            filter: brightness(95%);
            background-color: var(--md-sys-color-error-container); /* Keep bg */
        }
         .dark-theme .delete-btn:hover {
            filter: brightness(110%);
         }

        /* Material Symbols */
        .material-symbols-outlined {
          font-variation-settings:
          'FILL' 0,
          'wght' 400,
          'GRAD' 0,
          'opsz' 24;
          vertical-align: middle; /* Align icons better with text */
          font-size: 1.25em; /* Slightly larger default size */
          line-height: 1; /* Prevent extra space */
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--md-sys-color-surface-variant); /* Navigation Rail style */
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
            padding: 0.5rem 0;
            display: flex;
            justify-content: space-around;
            align-items: stretch; /* Stretch items vertically */
            z-index: 1000;
            border-top: 1px solid var(--md-sys-color-outline-variant);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Center content vertically */
            text-decoration: none;
            color: var(--md-sys-color-on-surface-variant);
            font-size: 0.75rem; /* Smaller text */
            padding: 0.25rem 0.75rem;
            border-radius: var(--border-radius-medium);
            transition: all 0.3s ease;
            flex: 1; /* Distribute space */
            text-align: center;
            min-height: 56px; /* Standard height */
            position: relative; /* For indicator positioning */
             overflow: hidden; /* Hide overflow */
        }

        .nav-item .material-symbols-outlined {
            font-size: 1.75rem; /* Larger icon */
            margin-bottom: 2px;
            transition: font-variation-settings 0.3s ease;
        }
         .nav-item span { /* Label */
             display: block;
             line-height: 1.2;
             white-space: nowrap; /* Prevent label wrapping */
         }

        .nav-item.active {
            color: var(--md-sys-color-primary);
            font-weight: 500;
            transform: translateY(-4px); /* Solleva leggermente l'elemento attivo */
            transition: transform 0.3s ease, color 0.3s ease, font-weight 0.3s ease;
        }

        .nav-item {
            transition: transform 0.3s ease, color 0.3s ease, font-weight 0.3s ease;
        }

        .nav-item.active .material-symbols-outlined {
            font-variation-settings: 'FILL' 1, 'wght' 600; /* Fill active icon and make it bolder */
            font-size: 2rem; /* Icona più grande per l'elemento attivo */
            transition: font-variation-settings 0.3s ease, font-size 0.3s ease;
        }

        /* Indicatore per l'elemento attivo - sfondo più grande e visibile */
        .nav-item.active::before {
            content: '';
            display: block;
            width: 100%; /* Occupa tutta la larghezza dell'elemento */
            height: 32px; /* Più alto per maggiore visibilità */
            background-color: var(--md-sys-color-primary-container);
            border-radius: var(--border-radius-medium);
            position: absolute;
            top: 2px; /* Posizionato più in alto */
            left: 50%;
            transform: translateX(-50%);
            opacity: 0.9; /* Leggermente trasparente */
            transition: all 0.3s ease;
            z-index: -1;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Ombra leggera */
        }

        /* Bordo inferiore per l'elemento attivo */
        .nav-item.active::after {
            content: '';
            display: block;
            width: 60%;
            height: 3px;
            background-color: var(--md-sys-color-primary);
            border-radius: var(--border-radius-full);
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            transition: width 0.3s ease;
        }

        .nav-item::before { /* Hidden normally */
            content: '';
            display: block;
            width: 100%;
            height: 32px;
            background-color: var(--md-sys-color-primary-container);
            border-radius: var(--border-radius-medium);
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            z-index: -1;
            transition: all 0.3s ease;
        }

        /* Hover effect */
        .nav-item:hover::before {
            opacity: 0.3; /* Mostra leggermente lo sfondo in hover */
        }


        .nav-item:hover {
            color: var(--md-sys-color-on-surface);
        }


        /* Section Visibility with improved transitions */
        .section {
            display: none;
            animation: none;
        }
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }

        /* Aggiungiamo un indicatore di sezione nella parte superiore */
        .section.active::before {
            content: '';
            display: block;
            width: 50px;
            height: 4px;
            background-color: var(--md-sys-color-primary);
            border-radius: var(--border-radius-full);
            margin: -0.5rem auto 1rem auto;
        }

        /* Time Entries List */
        #timeEntries .time-entry {
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
            padding: 1rem 0;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }
        #timeEntries .time-entry:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .time-entry-info {
            flex-grow: 1;
        }
        .time-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.25rem;
        }
        .time-entry-date {
            font-weight: 500;
            color: var(--md-sys-color-primary);
        }
        .time-entry-hours {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--md-sys-color-secondary);
        }
        /* Codice duplicato rimosso */
        /* Material Design 3 Inspired Theme - Android 2025 */

        :root {
            /* Light Theme Palette (Material You - Teal/Blue Base) */
            --md-sys-color-primary: #006A6A;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #9DF2F1;
            --md-sys-color-on-primary-container: #002020;
            --md-sys-color-secondary: #4A6363;
            --md-sys-color-on-secondary: #FFFFFF;
            --md-sys-color-secondary-container: #CCE8E7;
            --md-sys-color-on-secondary-container: #051F1F;
            --md-sys-color-tertiary: #4B607C;
            --md-sys-color-on-tertiary: #FFFFFF;
            --md-sys-color-tertiary-container: #D3E4FF;
            --md-sys-color-on-tertiary-container: #041C35;
            --md-sys-color-error: #BA1A1A;
            --md-sys-color-on-error: #FFFFFF;
            --md-sys-color-error-container: #FFDAD6;
            --md-sys-color-on-error-container: #410002;
            --md-sys-color-background: #FAFDFC;
            --md-sys-color-on-background: #191C1C;
            --md-sys-color-surface: #FAFDFC;
            --md-sys-color-on-surface: #191C1C;
            --md-sys-color-surface-variant: #DAE5E4;
            --md-sys-color-on-surface-variant: #3F4948;
            --md-sys-color-outline: #6F7979;
            --md-sys-color-outline-variant: #BFC9C8;
            --md-sys-color-shadow: #000000;
            --md-sys-color-scrim: #000000;
            --body-font-family: 'Roboto', sans-serif;
            --base-font-size: 16px;
            --border-radius-small: 8px;
            --border-radius-medium: 12px;
            --border-radius-large: 16px;
            --border-radius-full: 999px;
            --elevation-1: 0px 1px 2px rgba(0, 0, 0, 0.3), 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
            --elevation-2: 0px 1px 2px rgba(0, 0, 0, 0.3), 0px 2px 6px 2px rgba(0, 0, 0, 0.15);
            --elevation-3: 0px 4px 8px 3px rgba(0, 0, 0, 0.15), 0px 1px 3px rgba(0, 0, 0, 0.3);
            --elevation-4: 0px 6px 10px 4px rgba(0, 0, 0, 0.15), 0px 2px 3px rgba(0, 0, 0, 0.3);
            --elevation-5: 0px 8px 12px 6px rgba(0, 0, 0, 0.15), 0px 4px 4px rgba(0, 0, 0, 0.3);
        }

        /* Dark Theme Palette */
        .dark-theme {
            --md-sys-color-primary: #81D5D4;
            --md-sys-color-on-primary: #003737;
            --md-sys-color-primary-container: #00504F;
            --md-sys-color-on-primary-container: #9DF2F1;
            --md-sys-color-secondary: #B0CCCB;
            --md-sys-color-on-secondary: #1C3534;
            --md-sys-color-secondary-container: #334B4B;
            --md-sys-color-on-secondary-container: #CCE8E7;
            --md-sys-color-tertiary: #B3C8E8;
            --md-sys-color-on-tertiary: #1D314B;
            --md-sys-color-tertiary-container: #344863;
            --md-sys-color-on-tertiary-container: #D3E4FF;
            --md-sys-color-error: #FFB4AB;
            --md-sys-color-on-error: #690005;
            --md-sys-color-error-container: #93000A;
            --md-sys-color-on-error-container: #FFDAD6;
            --md-sys-color-background: #191C1C;
            --md-sys-color-on-background: #E0E3E2;
            --md-sys-color-surface: #191C1C;
            --md-sys-color-on-surface: #E0E3E2;
            --md-sys-color-surface-variant: #3F4948;
            --md-sys-color-on-surface-variant: #BFC9C8;
            --md-sys-color-outline: #899392;
            --md-sys-color-outline-variant: #3F4948;
            /* Shadow and Scrim remain black */
            --md-sys-color-inverse-surface: #E0E3E2;
            --md-sys-color-inverse-on-surface: #191C1C;
            --md-sys-color-inverse-primary: #006A6A;
        }

        /* Global Styles */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: var(--base-font-size);
        }

        body {
            font-family: var(--body-font-family);
            background-color: var(--md-sys-color-background);
            color: var(--md-sys-color-on-background);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding-bottom: 80px; /* Space for bottom nav */
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* Header */
        header {
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            box-shadow: var(--elevation-1);
            padding: 0.75rem 1rem;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo img {
            max-height: 40px; /* Adjusted logo size */
            width: auto;
            display: block;
        }

        /* Animazione logo rimbalzante */
        @keyframes bounce-horizontal {
            0%, 100% {
                transform: translateX(0) rotate(0deg);
                animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
            }
            25% {
                transform: translateX(15px) rotate(5deg);
                animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
            }
            50% {
                transform: translateX(0) rotate(0deg);
                animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
            }
            75% {
                transform: translateX(-15px) rotate(-5deg);
                animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
            }
        }

        .bouncing-logo {
            animation: bounce-horizontal 2s infinite;
            transform-origin: center;
            cursor: pointer;
            transition: filter 0.3s ease;
        }

        .bouncing-logo:hover {
            filter: drop-shadow(0 0 5px var(--md-sys-color-primary));
            animation-play-state: paused;
        }

        /* Animazione più vivace quando l'utente clicca sul logo */
        @keyframes bounce-excited {
            0%, 100% {
                transform: translateX(0) rotate(0deg) scale(1);
                animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
            }
            10% {
                transform: translateX(20px) rotate(10deg) scale(1.2);
            }
            20% {
                transform: translateX(-20px) rotate(-15deg) scale(1.1);
            }
            30% {
                transform: translateX(15px) rotate(15deg) scale(1.15);
            }
            40% {
                transform: translateX(-15px) rotate(-10deg) scale(1.05);
            }
            50% {
                transform: translateY(-15px) rotate(5deg) scale(1.1);
            }
            60% {
                transform: translateY(10px) rotate(-5deg) scale(1.05);
            }
            70% {
                transform: translateX(20px) translateY(-5px) rotate(10deg) scale(1.1);
            }
            80% {
                transform: translateX(-20px) translateY(5px) rotate(-10deg) scale(1.05);
            }
            90% {
                transform: translateX(10px) translateY(-3px) rotate(5deg) scale(1.02);
            }
        }

        .bouncing-logo-excited {
            animation: bounce-excited 2s ease-in-out;
            transform-origin: center;
            cursor: pointer;
            filter: drop-shadow(0 0 8px var(--md-sys-color-primary));
        }

        /* Stili per l'overlay della GIF del supereroe - Rimossi per ottimizzazione */

        .superhero-gif {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Riempie l'intero contenitore */
            object-position: center;
            display: block;
            margin: 0;
            border-radius: 0;
            box-shadow: none;
        }

        /* Stile specifico per desktop */
        @media (min-width: 1024px) {
            .superhero-container {
                width: 90%;
                max-width: 1200px;
                height: auto;
                max-height: 90vh;
            }

            .superhero-gif {
                object-fit: contain;
                border-radius: var(--border-radius-large);
                box-shadow: var(--elevation-5);
            }
        }

        .close-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background-color: var(--md-sys-color-error);
            color: var(--md-sys-color-on-error);
            border: none;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: var(--elevation-5);
            z-index: 10000;
            transition: all 0.3s ease;
            animation: pulse-animation 1.5s infinite;
            font-size: 1.5rem;
        }

        .close-btn .material-symbols-outlined {
            font-size: 30px;
            font-weight: bold;
        }

        .close-btn:hover, .close-btn:active {
            background-color: #d32f2f;
            transform: scale(1.1);
            animation-play-state: paused;
        }

        /* Stile per il messaggio RIP */
        .rip-message {
            position: fixed;
            top: 0;
            left: 50%; /* Posizionato al centro */
            transform: translateX(-50%) translateY(-100%); /* Inizialmente fuori dallo schermo */
            background-color: #000000;
            color: #ffffff;
            padding: 10px 15px;
            border-radius: 0 0 var(--border-radius-medium) var(--border-radius-medium);
            box-shadow: var(--elevation-3);
            z-index: 1001; /* Sopra l'header ma sotto il pulsante di chiusura */
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: transform 0.5s ease;
            font-weight: bold;
            min-width: 200px;
            text-align: center;
        }

        .rip-message.visible {
            transform: translateX(-50%) translateY(0); /* Scende dall'alto */
        }

        .rip-message::before {
            content: "☠️";
            font-size: 1.2rem;
        }

        .rip-message::after {
            content: "☠️";
            font-size: 1.2rem;
        }

        /* Animazione principale per il pulsante che scappa - stile cartoon */
        @keyframes escape-animation {
            0% { transform: translate(0, 0) scale(1) rotate(0deg); filter: brightness(1); }
            10% { transform: translate(-40px, -30px) scale(1.3) rotate(-15deg); filter: brightness(1.2); }
            20% { transform: translate(35px, 45px) scale(0.7) rotate(20deg); filter: brightness(0.9); }
            30% { transform: translate(50px, 60px) scale(1.4) rotate(-25deg); filter: brightness(1.3); }
            40% { transform: translate(-45px, -55px) scale(0.6) rotate(30deg); filter: brightness(0.8); }
            50% { transform: translate(60px, 20px) scale(1.2) rotate(-35deg); filter: brightness(1.4); }
            60% { transform: translate(-55px, 50px) scale(0.8) rotate(40deg); filter: brightness(0.7); }
            70% { transform: translate(40px, -40px) scale(1.5) rotate(-45deg); filter: brightness(1.5); }
            80% { transform: translate(-60px, -25px) scale(0.7) rotate(50deg); filter: brightness(0.9); }
            90% { transform: translate(50px, 55px) scale(1.3) rotate(-55deg); filter: brightness(1.3); }
            100% { transform: translate(0, 0) scale(1) rotate(0deg); filter: brightness(1); }
        }

        /* Animazione per l'effetto di squash e stretch */
        @keyframes squash-stretch {
            0%, 100% { transform: scale(1, 1); }
            25% { transform: scale(1.3, 0.7); }
            50% { transform: scale(0.7, 1.3); }
            75% { transform: scale(1.1, 0.9); }
        }

        /* Animazione per l'effetto di vibrazione */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px) rotate(-2deg); }
            20%, 40%, 60%, 80% { transform: translateX(5px) rotate(2deg); }
        }

        /* Classe per il pulsante che scappa */
        .escaping {
            animation: escape-animation 0.4s infinite;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.7);
            transition: all 0.1s ease;
            z-index: 10000;
            position: fixed !important;
        }

        /* Effetto hover sul pulsante che scappa */
        .escaping:hover {
            animation-duration: 0.2s !important;
            filter: hue-rotate(180deg) brightness(1.5);
        }

        /* Animazione di morte per il pulsante */
        @keyframes button-death {
            0% { transform: scale(1) rotate(0deg); opacity: 1; filter: brightness(1); box-shadow: 0 0 20px red; }
            10% { transform: scale(1.5) rotate(10deg); opacity: 0.9; filter: brightness(1.5) hue-rotate(30deg); box-shadow: 0 0 30px orange; }
            20% { transform: scale(0.8) rotate(-15deg); opacity: 0.8; filter: brightness(0.8) hue-rotate(60deg); box-shadow: 0 0 40px yellow; }
            30% { transform: scale(1.3) rotate(20deg); opacity: 0.7; filter: brightness(1.3) hue-rotate(90deg); box-shadow: 0 0 50px green; }
            40% { transform: scale(0.7) rotate(-25deg); opacity: 0.6; filter: brightness(0.7) hue-rotate(120deg); box-shadow: 0 0 60px blue; }
            50% { transform: scale(1.2) rotate(30deg); opacity: 0.5; filter: brightness(1.2) hue-rotate(150deg); box-shadow: 0 0 70px indigo; }
            60% { transform: scale(0.6) rotate(-35deg); opacity: 0.4; filter: brightness(0.6) hue-rotate(180deg); box-shadow: 0 0 80px violet; }
            70% { transform: scale(1.1) rotate(40deg); opacity: 0.3; filter: brightness(1.1) hue-rotate(210deg); box-shadow: 0 0 90px red; }
            80% { transform: scale(0.5) rotate(-45deg); opacity: 0.2; filter: brightness(0.5) hue-rotate(240deg); box-shadow: 0 0 100px orange; }
            90% { transform: scale(0.3) rotate(50deg); opacity: 0.1; filter: brightness(0.3) hue-rotate(270deg); box-shadow: 0 0 110px yellow; }
            100% { transform: scale(0) rotate(360deg); opacity: 0; filter: brightness(0) hue-rotate(360deg); box-shadow: 0 0 120px white; }
        }

        .dying-button {
            animation: button-death 2s forwards !important;
            position: fixed !important;
            z-index: 10000 !important;
            pointer-events: none !important;
            /* Assicurati che non ci siano altre animazioni in esecuzione */
            transform-origin: center !important;
            will-change: transform, opacity, filter, box-shadow !important;
        }

        /* Stile per evidenziare il pulsante di login */
        @keyframes highlight-pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 106, 106, 0.7); transform: scale(1); }
            50% { box-shadow: 0 0 0 10px rgba(0, 106, 106, 0); transform: scale(1.05); }
            100% { box-shadow: 0 0 0 0 rgba(0, 106, 106, 0); transform: scale(1); }
        }

        .highlight-button {
            animation: highlight-pulse 1.5s infinite;
            box-shadow: 0 0 10px var(--md-sys-color-primary);
            position: relative;
            z-index: 100;
        }

        @keyframes pulse-animation {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 82, 82, 0.7);
            }
            70% {
                transform: scale(1.1);
                box-shadow: 0 0 0 10px rgba(255, 82, 82, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 82, 82, 0);
            }
        }

        /* Stili per dispositivi mobili */
        @media (max-width: 768px) {
            .close-btn {
                top: 15px;
                right: 15px;
                width: 45px;
                height: 45px;
            }

            .close-btn .material-symbols-outlined {
                font-size: 24px;
            }
        }
        /* Removed troll-related JavaScript functionality */
        /* Removed troll-related event listeners and functions */

        main {
            padding: 1rem;
            margin-top: 70px; /* Adjusted for header height */
        }

        /* Card */
        .card {
            background-color: var(--md-sys-color-surface-variant); /* Slightly different bg */
            color: var(--md-sys-color-on-surface-variant);
            border-radius: var(--border-radius-large);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--elevation-1);
            border: 1px solid var(--md-sys-color-outline-variant);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        .card h2, .card h3 {
            color: var(--md-sys-color-primary);
            margin-bottom: 1rem;
            font-weight: 500;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.25rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
            color: var(--md-sys-color-on-surface-variant);
        }

        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="tel"],
        textarea,
        select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid var(--md-sys-color-outline);
            border-radius: var(--border-radius-small);
            font-size: 1rem;
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            appearance: none; /* For select */
            -webkit-appearance: none;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 2px var(--md-sys-color-primary-container);
        }

        select {
             /* Add arrow for select */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 -960 960 960' width='24'%3E%3Cpath d='M480-345 240-585l56-56 184 184 184-184 56 56-240 240Z' fill='%23${(getComputedStyle(document.documentElement).getPropertyValue('--md-sys-color-on-surface').trim() || '#191C1C').substring(1)}'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.5em;
            padding-right: 3rem; /* Space for arrow */
        }
        .dark-theme select {
             background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 -960 960 960' width='24'%3E%3Cpath d='M480-345 240-585l56-56 184 184 184-184 56 56-240 240Z' fill='%23${(getComputedStyle(document.documentElement).getPropertyValue('--md-sys-color-on-surface').trim() || '#E0E3E2').substring(1)}'/%3E%3C/svg%3E");
        }


        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group-inline {
            flex: 1;
            min-width: 120px;
        }

        /* Buttons */
        button, .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius-full); /* Pill shape */
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.1s ease;
            box-shadow: var(--elevation-1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        button:hover, .btn:hover {
            box-shadow: var(--elevation-2);
        }

        button:active, .btn:active {
            transform: scale(0.98);
            box-shadow: none;
        }

        /* Filled Button (Primary Action) */
        button[type="submit"], #submitBtn, #saveUserName, #addVehicle, #exportData, #importData, #saveFerieMalattie, .export-btn, .edit-all-btn, #addEntryBtn {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
        }
        button[type="submit"]:hover, #submitBtn:hover, #saveUserName:hover, #addVehicle:hover, #exportData:hover, #importData:hover, #saveFerieMalattie:hover, .export-btn:hover, .edit-all-btn:hover, #addEntryBtn:hover {
             /* Slightly darker/lighter on hover - generate this if needed */
            filter: brightness(90%);
        }
        .dark-theme button[type="submit"]:hover, .dark-theme #submitBtn:hover, .dark-theme #saveUserName:hover, .dark-theme #addVehicle:hover, .dark-theme #exportData:hover, .dark-theme #importData:hover, .dark-theme #saveFerieMalattie:hover, .dark-theme .export-btn:hover, .dark-theme .edit-all-btn:hover, .dark-theme #addEntryBtn:hover {
            filter: brightness(110%);
        }

        /* Error/Destructive Button */
        #clearData, .delete-btn, .delete-ferie-btn, .delete-vehicle-btn {
            background-color: var(--md-sys-color-error);
            color: var(--md-sys-color-on-error);
        }
         #clearData:hover, .delete-btn:hover, .delete-ferie-btn:hover, .delete-vehicle-btn:hover {
            filter: brightness(90%);
        }
        .dark-theme #clearData:hover, .dark-theme .delete-btn:hover, .dark-theme .delete-ferie-btn:hover, .dark-theme .delete-vehicle-btn:hover {
            filter: brightness(110%);
        }


        /* Text Button (e.g., Cancel) */
        .form-buttons button:last-child, .close-modal {
             background-color: transparent;
             color: var(--md-sys-color-primary);
             box-shadow: none;
        }
         .form-buttons button:last-child:hover, .close-modal:hover {
            background-color: var(--md-sys-color-primary-container);
         }
        .close-modal { /* Specific style for modal close */
             font-size: 1.75rem;
             padding: 0.5rem;
             border-radius: 50%;
             line-height: 1;
             color: var(--md-sys-color-on-surface-variant);
             font-weight: normal;
             border: none; /* Ensure no border */
        }
        .close-modal:hover {
            color: var(--md-sys-color-on-primary-container);
        }


        /* Small Action Buttons (Edit/Delete in lists) */
        .edit-btn, .delete-btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            min-width: 36px;
            min-height: 36px;
            box-shadow: none;
            border-radius: var(--border-radius-small);
            text-transform: none;
            letter-spacing: normal;
            border: 1px solid transparent; /* Base border */
        }
        .edit-btn { /* Make edit look like an Outlined Button */
            background-color: transparent;
            color: var(--md-sys-color-primary);
            border-color: var(--md-sys-color-outline);
        }
        .edit-btn:hover {
             background-color: var(--md-sys-color-primary-container);
             border-color: var(--md-sys-color-primary-container);
        }
        .delete-btn {
            background-color: var(--md-sys-color-error-container);
            color: var(--md-sys-color-on-error-container);
        }
        .delete-btn:hover {
            filter: brightness(95%);
            background-color: var(--md-sys-color-error-container); /* Keep bg */
        }
         .dark-theme .delete-btn:hover {
            filter: brightness(110%);
         }

        /* Material Symbols */
        .material-symbols-outlined {
          font-variation-settings:
          'FILL' 0,
          'wght' 400,
          'GRAD' 0,
          'opsz' 24;
          vertical-align: middle; /* Align icons better with text */
          font-size: 1.25em; /* Slightly larger default size */
          line-height: 1; /* Prevent extra space */
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--md-sys-color-surface-variant); /* Navigation Rail style */
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
            padding: 0.5rem 0;
            display: flex;
            justify-content: space-around;
            align-items: stretch; /* Stretch items vertically */
            z-index: 1000;
            border-top: 1px solid var(--md-sys-color-outline-variant);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Center content vertically */
            text-decoration: none;
            color: var(--md-sys-color-on-surface-variant);
            font-size: 0.75rem; /* Smaller text */
            padding: 0.25rem 0.75rem;
            border-radius: var(--border-radius-medium);
            transition: all 0.3s ease;
            flex: 1; /* Distribute space */
            text-align: center;
            min-height: 56px; /* Standard height */
            position: relative; /* For indicator positioning */
             overflow: hidden; /* Hide overflow */
        }

        .nav-item .material-symbols-outlined {
            font-size: 1.75rem; /* Larger icon */
            margin-bottom: 2px;
            transition: font-variation-settings 0.3s ease;
        }
         .nav-item span { /* Label */
             display: block;
             line-height: 1.2;
             white-space: nowrap; /* Prevent label wrapping */
         }

        .nav-item.active {
            color: var(--md-sys-color-primary);
            font-weight: 500;
            transform: translateY(-4px); /* Solleva leggermente l'elemento attivo */
            transition: transform 0.3s ease, color 0.3s ease, font-weight 0.3s ease;
        }

        .nav-item {
            transition: transform 0.3s ease, color 0.3s ease, font-weight 0.3s ease;
        }

        .nav-item.active .material-symbols-outlined {
            font-variation-settings: 'FILL' 1, 'wght' 600; /* Fill active icon and make it bolder */
            font-size: 2rem; /* Icona più grande per l'elemento attivo */
            transition: font-variation-settings 0.3s ease, font-size 0.3s ease;
        }

        /* Indicatore per l'elemento attivo - sfondo più grande e visibile */
        .nav-item.active::before {
            content: '';
            display: block;
            width: 100%; /* Occupa tutta la larghezza dell'elemento */
            height: 32px; /* Più alto per maggiore visibilità */
            background-color: var(--md-sys-color-primary-container);
            border-radius: var(--border-radius-medium);
            position: absolute;
            top: 2px; /* Posizionato più in alto */
            left: 50%;
            transform: translateX(-50%);
            opacity: 0.9; /* Leggermente trasparente */
            transition: all 0.3s ease;
            z-index: -1;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Ombra leggera */
        }

        /* Bordo inferiore per l'elemento attivo */
        .nav-item.active::after {
            content: '';
            display: block;
            width: 60%;
            height: 3px;
            background-color: var(--md-sys-color-primary);
            border-radius: var(--border-radius-full);
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            transition: width 0.3s ease;
        }

        .nav-item::before { /* Hidden normally */
            content: '';
            display: block;
            width: 100%;
            height: 32px;
            background-color: var(--md-sys-color-primary-container);
            border-radius: var(--border-radius-medium);
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            z-index: -1;
            transition: all 0.3s ease;
        }

        /* Hover effect */
        .nav-item:hover::before {
            opacity: 0.3; /* Mostra leggermente lo sfondo in hover */
        }


        .nav-item:hover {
            color: var(--md-sys-color-on-surface);
        }


        /* Section Visibility with improved transitions */
        .section {
            display: none;
            animation: none;
        }
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }

        /* Aggiungiamo un indicatore di sezione nella parte superiore */
        .section.active::before {
            content: '';
            display: block;
            width: 50px;
            height: 4px;
            background-color: var(--md-sys-color-primary);
            border-radius: var(--border-radius-full);
            margin: -0.5rem auto 1rem auto;
        }

        /* Time Entries List */
        #timeEntries .time-entry {
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
            padding: 1rem 0;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }
        #timeEntries .time-entry:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .time-entry-info {
            flex-grow: 1;
        }
        .time-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.25rem;
        }
        .time-entry-date {
            font-weight: 500;
            color: var(--md-sys-color-primary);
        }
        .time-entry-hours {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--md-sys-color-secondary);
        }
        .time-entry-details {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin: 0.25rem 0;
            font-size: 0.8rem;
            color: var(--md-sys-color-on-surface-variant);
        }
        .time-entry-details span {
            background-color: var(--md-sys-color-surface);
            padding: 2px 8px;
            border-radius: var(--border-radius-small);
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .time-entry-details .material-symbols-outlined {
            font-size: 1em;
            color: var(--md-sys-color-secondary);
        }
        .time-entry-description {
            font-size: 0.9rem;
            color: var(--md-sys-color-on-surface-variant);
            margin-top: 0.25rem;
        }

        /* Stili per le righe di lavoro multiple */
        #work-descriptions-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 8px;
        }

        .work-description-row {
            display: flex;
            align-items: center;
        }

        .work-description-input {
            flex: 1;
        }

        .btn-remove-work {
            background: none;
            border: none;
            color: var(--md-sys-color-error);
            cursor: pointer;
            padding: 4px;
            margin-left: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-remove-work:hover {
            background-color: rgba(186, 26, 26, 0.1);
        }

        .btn-add-work {
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-primary);
            border: 1px dashed var(--md-sys-color-outline);
            padding: 8px 16px;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            margin-top: 8px;
            font-size: 0.9rem;
        }

        .btn-add-work:hover {
            background-color: var(--md-sys-color-primary-container);
        }
        .entry-buttons {
            display: flex;
            gap: 0.5rem;
            flex-shrink: 0; /* Prevent buttons from shrinking */
        }


        /* Settings */
        .settings-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: var(--md-sys-color-surface);
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: var(--border-radius-medium);
            flex-wrap: wrap; /* Wrap for smaller screens if needed */
        }
        .setting-label {
            font-weight: 500;
             margin-right: 1rem;
             margin-bottom: 0.5rem; /* Add space when wrapping */
             flex-shrink: 0;
        }
        .settings-input {
            flex-grow: 1;
            min-width: 150px; /* Prevent input becoming too small */
             margin-right: 0.5rem; /* Space before button */
        }
        .setting-item > button {
            flex-shrink: 0; /* Prevent button shrinking */
        }
        .setting-item .vehicles-manager { /* Full width for vehicle manager */
            width: 100%;
            margin-top: 0.5rem; /* Space when it's below label */
        }

        /* Stili per il controllo delle particelle */
        .toggle-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            border-radius: var(--border-radius-full);
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .toggle-button:hover {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
        }

        .particle-control-panel {
            width: 100%;
            margin-top: 1rem;
            padding: 1.5rem;
            background-color: var(--md-sys-color-surface);
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: var(--border-radius-medium);
            box-shadow: var(--elevation-1);
        }

        .particle-control-group {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
        }

        .particle-control-group:last-of-type {
            border-bottom: none;
            padding-bottom: 0;
        }

        .particle-control-group h3 {
            margin-bottom: 1rem;
            color: var(--md-sys-color-primary);
            font-size: 1.1rem;
            font-weight: 500;
        }

        .particle-control-item {
            margin-bottom: 1rem;
        }

        .particle-control-item label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .particle-control-item input[type="range"] {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: var(--md-sys-color-surface-variant);
            border-radius: var(--border-radius-full);
            outline: none;
        }

        .particle-control-item input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--md-sys-color-primary);
            cursor: pointer;
            box-shadow: var(--elevation-1);
        }

        .particle-control-item input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--md-sys-color-primary);
            cursor: pointer;
            box-shadow: var(--elevation-1);
            border: none;
        }

        .particle-control-item select {
            width: 100%;
            padding: 0.5rem;
            border-radius: var(--border-radius-small);
            border: 1px solid var(--md-sys-color-outline-variant);
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
        }

        .color-picker-container {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .color-picker-container input[type="color"] {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            padding: 0;
            background: none;
        }

        .small-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            cursor: pointer;
            border: 1px solid var(--md-sys-color-outline-variant);
            padding: 0;
        }

        .small-btn:hover {
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
        }

        .particle-control-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1rem;
        }

        .secondary-btn {
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
        }

        .primary-btn {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
        }


        /* Toggle Switch (Material Style) */
        .toggle-switch {
            --switch-width: 52px;
            --switch-height: 32px;
            --thumb-size: 24px;
            --track-padding: 4px;

            position: relative;
            display: inline-block;
            width: var(--switch-width);
            height: var(--switch-height);
            flex-shrink: 0;
        }

        /* Stili per i controlli di tempo con frecce */
        .time-input-container {
            display: flex;
            align-items: center;
            width: 100%;
        }

        .time-control-btn {
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: var(--border-radius-small);
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
            flex-shrink: 0;
        }

        .time-control-btn:hover {
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
        }

        .time-control-btn:active {
            transform: scale(0.95);
        }

        .time-input-container input {
            flex: 1;
            margin: 0 5px;
            text-align: center;
        }


        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--md-sys-color-surface-variant);
            border: 2px solid var(--md-sys-color-outline);
            transition: all .3s ease;
            border-radius: var(--switch-height); /* Fully rounded */
        }
        .toggle-slider:before { /* The Thumb */
            position: absolute;
            content: "";
            height: var(--thumb-size);
            width: var(--thumb-size);
            left: var(--track-padding);
            bottom: var(--track-padding);
            background-color: var(--md-sys-color-outline);
            transition: all .3s ease;
            border-radius: 50%;
            box-shadow: var(--elevation-1);
        }
        input:checked + .toggle-slider {
            background-color: var(--md-sys-color-primary);
            border-color: var(--md-sys-color-primary);
        }
        input:checked + .toggle-slider:before {
            background-color: var(--md-sys-color-on-primary);
            transform: translateX(calc(var(--switch-width) - var(--thumb-size) - 2 * var(--track-padding) - 4px)); /* Adjust 4px for border */
        }


        /* Calendar Styles */
        .calendar-container {
            margin-top: 1rem;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            background-color: rgba(0, 0, 0, 0.2) !important;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius-medium) var(--border-radius-medium) 0 0;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .dark-theme .calendar-header {
            background-color: rgba(255, 255, 255, 0.1) !important;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        .calendar-header button {
            background: none;
            border: none;
            font-size: 1.5rem; /* Icon size */
            cursor: pointer;
            color: white !important;
            padding: 0.5rem;
            border-radius: 50%;
            line-height: 1;
            display: inline-flex; /* Align icon */
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        .calendar-header button:hover {
            background-color: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }
         .dark-theme .calendar-header button:hover {
              background-color: rgba(255,255,255,0.2);
              transform: scale(1.1);
         }

        .calendar-title {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
            font-weight: 500;
            text-align: center;
            flex-grow: 1;
            justify-content: center;
        }
        .calendar-month {
            font-size: 1.25rem;
            color: white !important;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        .calendar-year {
            font-size: 1rem;
            opacity: 0.9;
            color: white !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px; /* Thin lines between days */
            background-color: var(--md-sys-color-outline-variant); /* Grid lines */
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: 0 0 var(--border-radius-medium) var(--border-radius-medium);
            overflow: hidden;
        }
        .calendar-weekday {
            text-align: center;
            font-weight: 500;
            padding: 0.75rem 0.25rem;
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            font-size: 0.8rem;
            text-transform: uppercase;
        }
        .calendar-day {
            min-height: 90px;
            padding: 8px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s;
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            text-align: center;
        }
        .calendar-day:hover {
            background-color: var(--md-sys-color-inverse-surface); /* Use inverse for hover */
            color: var(--md-sys-color-inverse-on-surface);
        }
        .calendar-day.empty {
            background-color: var(--md-sys-color-surface-variant);
            opacity: 0.5;
            cursor: default;
        }
        .calendar-day.empty:hover {
            background-color: var(--md-sys-color-surface-variant);
        }
        .calendar-day.today {
             /* Use outline instead of border */
             outline: 2px solid var(--md-sys-color-primary);
             outline-offset: -2px;
        }
        /* Style day with entries */
        .calendar-day.has-entries .calendar-day-number {
             font-weight: 700;
             color: var(--md-sys-color-primary);
        }
        .calendar-day-number {
            font-weight: 500;
            font-size: 0.875rem;
            width: 24px;
            height: 24px;
            line-height: 24px;
            border-radius: 50%;
            position: absolute;
            top: 4px;
            left: 4px;
            text-align: center;
             z-index: 1; /* Above content */
        }
        .calendar-day.today .calendar-day-number {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
        }
        .calendar-day-content {
            margin-top: 28px; /* Space below number */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            width: 100%;
        }
        .calendar-hours {
            font-size: 1rem;
            font-weight: 700;
            color: var(--md-sys-color-primary);
        }
        .calendar-icons {
            display: flex;
            justify-content: center;
             flex-wrap: wrap; /* Wrap icons if needed */
            gap: 4px;
            font-size: 1rem;
            line-height: 1; /* Prevent extra spacing */
        }
        .calendar-icons .material-symbols-outlined {
             font-size: 1.1em;
             color: var(--md-sys-color-secondary);
        }

        /* Stile per l'icona info */
        .info-icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
            border-radius: 50%;
            background-color: var(--md-sys-color-tertiary);
            color: var(--md-sys-color-on-tertiary);
            font-weight: bold;
            font-style: italic;
            font-size: 1rem;
            margin-bottom: 0.25rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            animation: pulse-info 2s infinite;
        }

        @keyframes pulse-info {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .calendar-holiday-name {
            font-size: 0.75rem;
            color: var(--md-sys-color-error);
            font-weight: 500;
            margin-top: auto; /* Push to bottom */
            padding-top: 4px;
             width: 100%; /* Take full width */
        }
         .calendar-day.holiday {
             background-color: var(--md-sys-color-error-container);
             color: var(--md-sys-color-on-error-container);
             outline: none; /* Remove today outline if holiday */
         }
         .calendar-day.holiday .calendar-day-number {
            background-color: var(--md-sys-color-error);
            color: var(--md-sys-color-on-error);
         }
         .calendar-day.holiday .calendar-holiday-name {
             color: var(--md-sys-color-on-error-container); /* Match text color */
         }

          .calendar-day.ferie {
             background-color: var(--md-sys-color-tertiary-container);
             color: var(--md-sys-color-on-tertiary-container);
             outline: none;
          }
           .calendar-day.ferie .calendar-icons .material-symbols-outlined {
               color: var(--md-sys-color-on-tertiary-container);
           }
            .calendar-day.ferie .calendar-holiday-name {
               color: var(--md-sys-color-on-tertiary-container);
           }

          .calendar-day.malattia {
             background-color: var(--md-sys-color-secondary-container);
             color: var(--md-sys-color-on-secondary-container);
             outline: none;
          }
            .calendar-day.malattia .calendar-icons .material-symbols-outlined {
               color: var(--md-sys-color-on-secondary-container);
           }
             .calendar-day.malattia .calendar-holiday-name {
               color: var(--md-sys-color-on-secondary-container);
           }
                   /* Calendar Share Styles */
        .calendar-share-container {
            margin-bottom: 1rem;
            display: flex;
            justify-content: center;
        }

        .calendar-share-btn {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius-full);
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
            box-shadow: var(--elevation-2);
            min-width: 120px;
            justify-content: center;
        }

        .calendar-share-btn:hover {
            background-color: var(--md-sys-color-primary);
            transform: translateY(-1px);
            box-shadow: var(--elevation-3);
        }

        .calendar-share-btn.success {
            background-color: #4CAF50;
            color: white;
        }

        .calendar-share-btn.success:hover {
            background-color: #45a049;
        }

        /* Calendar Paste Button */
        .calendar-buttons-container {
            margin-bottom: 1rem;
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .calendar-paste-btn {
            background-color: var(--md-sys-color-secondary);
            color: var(--md-sys-color-on-secondary);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius-large);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: var(--elevation-1);
            min-width: 120px;
            justify-content: center;
        }

        .calendar-paste-btn:hover {
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            box-shadow: var(--elevation-2);
            transform: translateY(-1px);
        }

        .calendar-paste-btn:active {
            transform: translateY(0);
            box-shadow: var(--elevation-1);
        }

        .calendar-paste-btn.processing {
            background-color: #FF9800;
            color: white;
        }

        .calendar-paste-btn.processing:hover {
            background-color: #F57C00;
        }

        .calendar-paste-btn.success {
            background-color: #4CAF50;
            color: white;
        }

        .calendar-paste-btn.success:hover {
            background-color: #45a049;
        }

        .calendar-paste-btn.error {
            background-color: var(--md-sys-color-error);
            color: var(--md-sys-color-on-error);
        }

        .calendar-paste-btn.error:hover {
            background-color: var(--md-sys-color-error-container);
            color: var(--md-sys-color-on-error-container);
        }

        /* Import Preview Modal */
        .import-preview-modal {
            display: none;
            position: fixed;
            z-index: 1100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .import-preview-content {
            background-color: var(--md-sys-color-surface);
            margin: 5% auto;
            padding: 1.5rem;
            border-radius: var(--border-radius-large);
            box-shadow: var(--elevation-5);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .import-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
        }

        .import-preview-title {
            color: var(--md-sys-color-on-surface);
            font-size: 1.25rem;
            font-weight: 500;
            margin: 0;
        }

        .import-close-btn {
            background: none;
            border: none;
            color: var(--md-sys-color-on-surface);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .import-close-btn:hover {
            background-color: var(--md-sys-color-surface-variant);
        }

        .import-preview-body {
            margin-bottom: 1.5rem;
        }

        .import-summary {
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            padding: 1rem;
            border-radius: var(--border-radius-medium);
            margin-bottom: 1rem;
        }

        .import-entries-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: var(--border-radius-medium);
            padding: 0.5rem;
        }

        .import-entry-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background-color: var(--md-sys-color-surface-variant);
            border-radius: var(--border-radius-small);
            border-left: 4px solid var(--md-sys-color-primary);
        }

        .import-entry-date {
            font-weight: 500;
            color: var(--md-sys-color-primary);
            margin-bottom: 0.25rem;
        }

        .import-entry-details {
            font-size: 0.875rem;
            color: var(--md-sys-color-on-surface-variant);
        }

        .import-preview-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .import-action-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius-medium);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .import-btn-cancel {
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
        }

        .import-btn-cancel:hover {
            background-color: var(--md-sys-color-outline-variant);
        }

        .import-btn-replace {
            background-color: var(--md-sys-color-error);
            color: var(--md-sys-color-on-error);
        }

        .import-btn-replace:hover {
            background-color: var(--md-sys-color-error-container);
            color: var(--md-sys-color-on-error-container);
        }

        .import-btn-merge {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
        }

        .import-btn-merge:hover {
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
        }

        .calendar-day-checkbox {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            cursor: pointer;
            display: none;
        }

        .calendar-day-checkbox input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        .calendar-day-checkbox .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 20px;
            width: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            border: 2px solid var(--md-sys-color-outline);
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .calendar-day-checkbox input:checked ~ .checkmark {
            background-color: var(--md-sys-color-primary);
            border-color: var(--md-sys-color-primary);
        }

        .calendar-day-checkbox .checkmark::after {
            content: "";
            position: absolute;
            display: none;
        }

        .calendar-day-checkbox input:checked ~ .checkmark::after {
            display: block;
        }

        .calendar-day-checkbox .checkmark::after {
            left: 6px;
            top: 2px;
            width: 4px;
            height: 8px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .calendar-day.selectable {
            position: relative;
            cursor: pointer;
        }

        .calendar-day.selectable:hover .calendar-day-checkbox {
            display: block;
        }

        .calendar-day.selected {
            background-color: var(--md-sys-color-primary-container);
            border: 2px solid var(--md-sys-color-primary);
        }

        .calendar-day.selected .calendar-day-checkbox {
            display: block;
        }

        .calendar-selection-mode .calendar-day.selectable .calendar-day-checkbox {
            display: block;
        }

        .calendar-selection-mode .calendar-day.selectable {
            cursor: pointer;
        }

        .calendar-selection-mode .calendar-day:not(.selectable) {
            opacity: 0.5;
        }


        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1050; /* Above nav */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: var(--md-sys-color-scrim); /* Scrim */
            background-color: rgba(0, 0, 0, 0.5); /* Fallback */
            animation: fadeIn 0.3s ease;
            padding: 1rem; /* Padding for scroll */
            visibility: visible; /* Assicura che il modale sia visibile quando display è 'block' */
        }
        .modal-content {
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            margin: 5vh auto; /* Vertically centered */
            padding: 1.5rem;
            border: none;
            width: 95%;
            max-width: 600px;
            border-radius: var(--border-radius-large);
            box-shadow: var(--elevation-4);
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
        }
        .modal-title {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--md-sys-color-primary);
        }
        .modal-body {
            margin-bottom: 1.5rem;
        }
        .modal-footer {
            text-align: right;
            padding-top: 1rem;
            border-top: 1px solid var(--md-sys-color-outline-variant);
        }
         .modal-footer button {
             margin-left: 0.5rem;
         }

        /* Day Details Modal Specifics */
        .day-summary {
            display: grid; /* Use grid for better alignment */
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 1rem;
            text-align: center;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: var(--md-sys-color-primary-container);
            border-radius: var(--border-radius-medium);
            color: var(--md-sys-color-on-primary-container);
        }
        .day-summary-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--md-sys-color-primary);
            display: block;
             line-height: 1.1;
        }
        .day-summary-label {
            font-size: 0.8rem;
            color: var(--md-sys-color-on-primary-container);
            opacity: 0.8;
            text-transform: uppercase;
             margin-top: 0.25rem;
             display: block;
        }
        .day-entries {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px; /* Space for scrollbar */
             margin-top: 1rem; /* Space after summary/actions */
        }
        /* Style day entries like time entries */
        .day-entry {
             border-bottom: 1px solid var(--md-sys-color-outline-variant);
             padding: 1rem 0;
             margin-bottom: 0.5rem;
             display: flex; /* Use flex for button alignment */
             justify-content: space-between;
             align-items: flex-start;
             gap: 1rem;
        }
        .day-entry:last-child { border-bottom: none; margin-bottom: 0; }
        .day-entry-info { flex-grow: 1; }
        .day-entry-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem; }
        .day-entry-hours { font-weight: bold; color: var(--md-sys-color-primary); }
        .day-entry-details { display: flex; flex-wrap: wrap; gap: 0.75rem; margin: 0.25rem 0; font-size: 0.8rem; color: var(--md-sys-color-on-surface-variant); }
         .day-entry-details span {
             background-color: var(--md-sys-color-surface);
             padding: 2px 8px;
             border-radius: var(--border-radius-small);
             display: inline-flex;
             align-items: center;
             gap: 4px;
         }
        .day-entry-description { margin-top: 0.25rem; font-size: 0.9rem; color: var(--md-sys-color-on-surface-variant); }
        .day-entry-vehicle {
            font-size: 0.8rem;
            color: var(--md-sys-color-on-surface-variant);
            margin-top: 4px;
            padding-left: 8px;
            border-left: 2px solid var(--md-sys-color-outline);
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .day-entry-vehicle .material-symbols-outlined { font-size: 1em; }
         .day-entry .entry-buttons { flex-shrink: 0; } /* Prevent buttons shrinking */
        .modal-actions {
             text-align: right;
             margin-bottom: 1rem;
        }

        /* Monthly Summary / Stats */
        .monthly-summary, .stats-container, .monthly-report-stats {
            display: grid; /* Use grid for better spacing */
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            justify-content: space-around; /* Center items */
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            border-radius: var(--border-radius-medium);
        }
        .monthly-summary h3 {
            grid-column: 1 / -1; /* Span full width */
            text-align: center;
            margin-bottom: 0.5rem;
            color: var(--md-sys-color-secondary);
            font-weight: 500;
        }
        .monthly-stat-item, .stat-card {
            text-align: center;
            padding: 0.75rem;
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            border-radius: var(--border-radius-medium);
            box-shadow: var(--elevation-1);
        }
        .monthly-stat-value, .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--md-sys-color-secondary);
            margin: 5px 0;
            display: block;
             line-height: 1.1;
        }
        .monthly-stat-label, .stat-label {
            font-size: 0.8rem;
            color: var(--md-sys-color-on-surface-variant);
            text-transform: uppercase;
             display: block;
             margin-top: 0.25rem;
        }

        /* Contacts Section */
        .contacts-container { display: flex; flex-direction: column; gap: 1.5rem; }
        .contact-address {
            padding: 1rem;
            background-color: var(--md-sys-color-tertiary-container);
            color: var(--md-sys-color-on-tertiary-container);
            border-radius: var(--border-radius-medium);
            margin-bottom: 1rem;
        }
        .contact-address .contact-item, .contact-info .contact-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        .contact-address .contact-item .material-symbols-outlined,
        .contact-info .contact-item .material-symbols-outlined {
            color: var(--md-sys-color-tertiary);
            font-size: 1.25rem;
             width: 24px; /* Fixed width for alignment */
             text-align: center;
             flex-shrink: 0;
        }
        .dark-theme .contact-address .contact-item .material-symbols-outlined,
        .dark-theme .contact-info .contact-item .material-symbols-outlined {
            color: var(--md-sys-color-tertiary); /* Keep same color */
        }
        .contact-group h3 {
            color: var(--md-sys-color-secondary);
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
            font-weight: 500;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
            padding-bottom: 0.5rem;
        }

        /* Stili per l'aggiunta di contatti */
        .add-contact-container {
            display: flex;
            justify-content: center;
            margin-top: 1.5rem;
        }

        #addContactBtn {
            background-color: var(--md-sys-color-secondary);
            color: var(--md-sys-color-on-secondary);
            transition: all 0.3s ease;
        }

        #addContactBtn:hover {
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            transform: translateY(-2px);
        }

        /* Stili per il modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1050;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.show {
            display: block;
            opacity: 1;
        }

        .modal-content {
            background-color: var(--md-sys-color-surface);
            margin: 10% auto;
            width: 90%;
            max-width: 500px;
            border-radius: var(--border-radius-large);
            box-shadow: var(--elevation-3);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
            border: 1px solid var(--md-sys-color-outline-variant);
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
        }

        .modal-header h3 {
            color: var(--md-sys-color-primary);
            margin: 0;
        }

        .close-modal {
            color: var(--md-sys-color-on-surface-variant);
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .close-modal:hover {
            color: var(--md-sys-color-error);
        }

        .modal-body {
            padding: 1rem;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn-secondary {
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius-full);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: background-color 0.2s ease;
        }

        .btn-secondary:hover {
            background-color: var(--md-sys-color-outline);
        }
        .contact-card {
            background-color: var(--md-sys-color-surface);
            border-radius: var(--border-radius-medium);
            padding: 1rem;
            box-shadow: var(--elevation-1);
            margin-bottom: 1rem;
            border: 1px solid var(--md-sys-color-outline-variant);
        }
        .contact-name {
            font-weight: 500;
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
            color: var(--md-sys-color-on-surface);
        }
        .contact-info { display: flex; flex-direction: column; gap: 0.5rem; }
        .contact-item a {
            color: var(--md-sys-color-primary);
            text-decoration: none;
            transition: color 0.2s;
            word-break: break-all; /* Prevent long emails breaking layout */
        }
        .contact-item a:hover {
            text-decoration: underline;
             filter: brightness(80%);
        }
         .dark-theme .contact-item a:hover {
            filter: brightness(120%);
         }

        /* QR Code */
        .qr-code-container {
            margin-top: 1.5rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        /* --- Modern Flatpickr Styling (2025 Inspired) --- */

        /* Stili per il calendario */

        /* Stili specifici per il modale del calendario */
        #dayModal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #dayModal.visible {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            pointer-events: auto !important;
        }
        .flatpickr-calendar {
            background: var(--md-sys-color-surface) !important;
        }
        .flatpickr-months,
        .flatpickr-month,
        .flatpickr-weekdays,
        .flatpickr-weekdaycontainer,
        .dayContainer,
        .flatpickr-days,
        .flatpickr-innerContainer,
        .flatpickr-rContainer,
        .flatpickr-time {
            background: var(--md-sys-color-surface) !important;
        }

        /* Stile per l'header del calendario - con alta specificità */
        html body .flatpickr-calendar .flatpickr-months .flatpickr-month {
            background-color: var(--md-sys-color-primary-container) !important;
            color: var(--md-sys-color-on-primary-container) !important;
            fill: var(--md-sys-color-on-primary-container) !important;
        }

        /* Stile per i pulsanti di navigazione - con alta specificità */
        html body .flatpickr-calendar .flatpickr-months .flatpickr-prev-month,
        html body .flatpickr-calendar .flatpickr-months .flatpickr-next-month {
            background-color: var(--md-sys-color-primary-container) !important;
            fill: var(--md-sys-color-on-primary-container) !important;
            position: relative !important;
            padding: 8px !important;
            height: auto !important;
            width: auto !important;
            border-radius: var(--border-radius-small) !important;
            margin: 0 5px !important;
            top: 0 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            cursor: pointer !important;
        }

        html body .flatpickr-calendar .flatpickr-months .flatpickr-prev-month:hover,
        html body .flatpickr-calendar .flatpickr-months .flatpickr-next-month:hover {
            background-color: rgba(255, 255, 255, 0.2) !important;
        }

        html body .flatpickr-calendar .flatpickr-months .flatpickr-prev-month svg,
        html body .flatpickr-calendar .flatpickr-months .flatpickr-next-month svg {
            width: 20px !important;
            height: 20px !important;
            fill: var(--md-sys-color-on-primary-container) !important;
        }

        /* Stile per i dropdown e gli input - con alta specificità */
        html body .flatpickr-calendar .flatpickr-months .flatpickr-current-month .flatpickr-monthDropdown-months,
        html body .flatpickr-calendar .flatpickr-months .flatpickr-current-month input.cur-year {
            background-color: var(--md-sys-color-primary-container) !important;
            color: var(--md-sys-color-on-primary-container) !important;
        }

        /* Stile per i giorni della settimana - con alta specificità */
        html body .flatpickr-calendar .flatpickr-weekdays {
            background: var(--md-sys-color-surface-variant) !important;
        }

        html body .flatpickr-calendar .flatpickr-weekday {
            background: var(--md-sys-color-surface-variant) !important;
            color: var(--md-sys-color-on-surface-variant) !important;
        }

        /* Stile per il dropdown dei mesi con alta specificità */
        html body .flatpickr-calendar .flatpickr-months .flatpickr-monthDropdown-month {
            background-color: var(--md-sys-color-primary-container) !important;
            color: var(--md-sys-color-on-primary-container) !important;
            font-size: 1em !important;
            padding: 8px 12px !important;
        }

        /* Stile per il tema scuro */
        html body.dark-theme .flatpickr-calendar .flatpickr-months .flatpickr-month,
        html body.dark-theme .flatpickr-calendar .flatpickr-months .flatpickr-prev-month,
        html body.dark-theme .flatpickr-calendar .flatpickr-months .flatpickr-next-month,
        html body.dark-theme .flatpickr-calendar .flatpickr-months .flatpickr-current-month .flatpickr-monthDropdown-months,
        html body.dark-theme .flatpickr-calendar .flatpickr-months .flatpickr-current-month input.cur-year,
        html body.dark-theme .flatpickr-calendar .flatpickr-weekday {
            color: var(--md-sys-color-on-surface) !important;
            fill: var(--md-sys-color-on-surface) !important;
        }

        /* Stile per l'input dell'anno */
        .numInput,
        .cur-year {
            background: transparent !important;
            color: var(--md-sys-color-on-surface) !important;
        }

        /* Stile per il contenitore del tempo */
        .flatpickr-time,
        .flatpickr-time input,
        .flatpickr-time .numInputWrapper,
        .flatpickr-time .flatpickr-am-pm {
            background: var(--md-sys-color-surface) !important;
            color: var(--md-sys-color-on-surface) !important;
        }

        /* Stile per i separatori */
        .flatpickr-time .flatpickr-time-separator {
            color: var(--md-sys-color-on-surface) !important;
        }

        .flatpickr-calendar {
            background: var(--md-sys-color-surface) !important; /* Sfondo solido */
            border-radius: var(--border-radius-large); /* More pronounced rounding */
            box-shadow: var(--elevation-3);
            border: 1px solid var(--md-sys-color-outline-variant);
            padding: 10px; /* Overall padding */
            width: 320px; /* Slightly wider */
            color: var(--md-sys-color-on-surface);
            font-family: 'Roboto', sans-serif;
        }

        /* Header (Month/Year/Arrows) */
        .flatpickr-months {
            background: var(--md-sys-color-primary-container) !important;
            padding: 10px;
            border-radius: var(--border-radius-medium) var(--border-radius-medium) 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        .flatpickr-current-month {
            color: var(--md-sys-color-on-primary-container);
            font-size: 1.1em;
            font-weight: 500;
            position: relative;
            flex-grow: 1; /* Allow month name to take space */
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .flatpickr-current-month .flatpickr-monthDropdown-months {
            border: none;
            background: transparent;
            color: inherit;
            font-size: 1.1em;
            font-weight: 500;
            padding: 5px 15px;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .flatpickr-current-month .flatpickr-monthDropdown-months:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Nascondi completamente il selettore dell'anno */
        .flatpickr-current-month .numInputWrapper {
            display: none;
        }

        /* Weekdays (Mo, Tu...) */
        .flatpickr-weekdays {
            background: transparent;
            padding: 5px 0;
            display: flex;
            justify-content: space-around;
        }
        span.flatpickr-weekday {
            color: var(--md-sys-color-on-surface-variant);
            font-size: 0.8em;
            font-weight: 500;
            text-align: center;
            flex: 1; /* Distribute space evenly */
        }

        /* Day Container */
        .dayContainer {
            padding: 5px 0 0 0; /* Add some space above days */
            display: grid; /* Use grid */
            grid-template-columns: repeat(7, 1fr); /* 7 equal columns */
            gap: 2px; /* Small gap between days */
        }

        /* Individual Days */
        .flatpickr-day {
            background: transparent;
            border: none;
            color: var(--md-sys-color-on-surface);
            font-size: 0.9em;
            width: 36px; /* Fixed width */
            height: 36px; /* Fixed height */
            line-height: 36px; /* Center text vertically */
            text-align: center;
            border-radius: 50%; /* Circular shape */
            margin: 0; /* Remove default margins */
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            justify-self: center; /* Center horizontally in grid cell */
            align-self: center; /* Center vertically in grid cell */
        }

        /* Giorni festivi (sabato e domenica) in rosso */
        .flatpickr-day.flatpickr-weekend {
            color: #E53935 !important; /* Rosso */
            font-weight: 500;
        }

        .flatpickr-day:hover {
             background-color: var(--md-sys-color-surface-container-highest);
        }

        .flatpickr-day.disabled,
        .flatpickr-day.disabled:hover {
            background: transparent;
            color: var(--md-sys-color-on-surface-variant);
            opacity: 0.5;
            cursor: default;
        }

        .flatpickr-day.prevMonthDay,
        .flatpickr-day.nextMonthDay {
            color: var(--md-sys-color-on-surface-variant);
            opacity: 0.7;
        }
        .flatpickr-day.prevMonthDay:hover,
        .flatpickr-day.nextMonthDay:hover {
             background-color: var(--md-sys-color-surface-container-highest);
        }

        /* Today Style */
        .flatpickr-day.today {
            /* Dotted outline style */
            border: 2px dotted var(--md-sys-color-outline);
            color: inherit; /* Use default text color */
            font-weight: normal; /* Reset font weight */
            background: transparent !important; /* Ensure no background */
        }
        .flatpickr-day.today:hover {
             background-color: var(--md-sys-color-surface-container-highest);
             color: var(--md-sys-color-on-surface);
        }

        /* Selected Day Style */
        .flatpickr-day.selected {
            position: relative;
            background-color: transparent !important;
            color: var(--md-sys-color-on-surface) !important;
            border: none !important;
            font-weight: 700 !important;
            z-index: 1;
        }

        /* Animazione per il bordo tratteggiato */
        @keyframes dash-animation {
            0% {
                stroke-dashoffset: 0;
            }
            100% {
                stroke-dashoffset: 100;
            }
        }

        /* Cerchio tratteggiato attorno al giorno selezionato */
        .flatpickr-day.selected::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 3px dashed var(--md-sys-color-primary);
            z-index: -1;
            background-color: rgba(0, 106, 106, 0.1); /* Colore primario con opacità */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            animation: pulse-selected 2s infinite ease-in-out;
        }

        /* Animazione di pulsazione per il giorno selezionato */
        @keyframes pulse-selected {
            0% {
                box-shadow: 0 0 0 0 rgba(0, 106, 106, 0.4);
            }
            70% {
                box-shadow: 0 0 0 6px rgba(0, 106, 106, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(0, 106, 106, 0);
            }
        }

        /* Hover sul giorno selezionato */
        .flatpickr-day.selected:hover {
            background-color: var(--md-sys-color-surface-container-highest) !important;
        }

        .flatpickr-day.selected:hover::before {
            border-width: 3px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }

        /* Today and Selected Style */
        .flatpickr-day.today.selected {
            position: relative;
            background-color: var(--md-sys-color-primary) !important;
            color: var(--md-sys-color-on-primary) !important;
            border: none !important;
            font-weight: 500 !important;
            z-index: 1;
        }

        /* Dark Theme Overrides */
        @media (prefers-color-scheme: dark) {
            .flatpickr-calendar {
                background: var(--md-sys-color-surface-container-high-dark);
                border: 1px solid var(--md-sys-color-outline-variant-dark);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                color: var(--md-sys-color-on-surface-dark);
            }
            .flatpickr-current-month {
                 color: var(--md-sys-color-on-surface-dark);
            }
             .flatpickr-current-month input.cur-year:hover {
                 background: var(--md-sys-color-surface-container-highest-dark);
            }
            .flatpickr-prev-month,
            .flatpickr-next-month {
                color: var(--md-sys-color-on-surface-variant-dark);
            }
            .flatpickr-prev-month:hover,
            .flatpickr-next-month:hover {
                background-color: var(--md-sys-color-surface-container-highest-dark);
                color: var(--md-sys-color-primary-dark);
            }
            span.flatpickr-weekday {
                color: var(--md-sys-color-on-surface-variant-dark);
            }
            .flatpickr-day {
                color: var(--md-sys-color-on-surface-dark);
            }

            /* Giorni festivi (sabato e domenica) in rosso per tema scuro */
            .flatpickr-day.flatpickr-weekend {
                color: #FF5252 !important; /* Rosso più chiaro per tema scuro */
                font-weight: 500;
            }
            .flatpickr-day:hover {
                background-color: var(--md-sys-color-surface-container-highest-dark);
            }
            .flatpickr-day.disabled,
            .flatpickr-day.disabled:hover {
                color: var(--md-sys-color-on-surface-variant-dark);
            }
            .flatpickr-day.prevMonthDay,
            .flatpickr-day.nextMonthDay {
                color: var(--md-sys-color-on-surface-variant-dark);
            }
             .flatpickr-day.prevMonthDay:hover,
             .flatpickr-day.nextMonthDay:hover {
                background-color: var(--md-sys-color-surface-container-highest-dark);
             }
            .flatpickr-day.today {
                position: relative;
                border: none;
                color: var(--md-sys-color-on-surface-dark);
                background-color: transparent !important;
                font-weight: 700;
                z-index: 1;
            }

            .flatpickr-day.today::before {
                content: "";
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 36px;
                height: 36px;
                border-radius: 50%;
                border: 3px solid var(--md-sys-color-primary-dark);
                background-color: rgba(129, 213, 212, 0.05); /* Colore primario dark con opacità bassa */
                z-index: -1;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            }

            .flatpickr-day.today:hover {
                background-color: var(--md-sys-color-surface-container-highest-dark) !important;
                color: var(--md-sys-color-on-surface-dark);
            }

            .flatpickr-day.today:hover::before {
                border-color: var(--md-sys-color-primary-dark);
                border-width: 3px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
             }
            .flatpickr-day.selected {
                position: relative;
                background-color: transparent !important;
                color: var(--md-sys-color-on-surface-dark) !important;
                border: none !important;
                font-weight: 700 !important;
                z-index: 1;
            }

            /* Cerchio tratteggiato attorno al giorno selezionato - tema scuro */
            .flatpickr-day.selected::before {
                border: 3px dashed var(--md-sys-color-primary-dark);
                background-color: rgba(129, 213, 212, 0.1); /* Colore primario dark con opacità */
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
                animation: pulse-selected-dark 2s infinite ease-in-out;
            }

            /* Animazione di pulsazione per il giorno selezionato - tema scuro */
            @keyframes pulse-selected-dark {
                0% {
                    box-shadow: 0 0 0 0 rgba(129, 213, 212, 0.4);
                }
                70% {
                    box-shadow: 0 0 0 6px rgba(129, 213, 212, 0);
                }
                100% {
                    box-shadow: 0 0 0 0 rgba(129, 213, 212, 0);
                }
            }

            /* Hover sul giorno selezionato - tema scuro */
            .flatpickr-day.selected:hover {
                background-color: var(--md-sys-color-surface-container-highest-dark) !important;
            }

            .flatpickr-day.selected:hover::before {
                border-width: 3px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.25);
            }

            .flatpickr-day.today.selected {
                position: relative;
                background-color: transparent !important;
                color: var(--md-sys-color-on-surface-dark) !important;
                border: none !important;
                font-weight: 700 !important;
            }

            /* Cerchio speciale per giorno corrente selezionato - tema scuro */
            .flatpickr-day.today.selected::before {
                border: 4px solid var(--md-sys-color-primary-dark);
                background-color: rgba(129, 213, 212, 0.15); /* Colore primario dark con opacità media */
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.25);
            }

            /* Aggiunta di un secondo cerchio tratteggiato esterno - tema scuro */
            .flatpickr-day.today.selected::after {
                border: 2px dashed var(--md-sys-color-primary-dark);
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            }

            /* Hover sul giorno corrente selezionato - tema scuro */
            .flatpickr-day.today.selected:hover::before {
                border-width: 4px;
                box-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
            }
        }

        /* --- End Modern Flatpickr Styling --- */

        /* --- Calendar Summary Styles (Restored Here) --- */
        #monthlySummary {
            margin-top: 0; /* Remove top margin to attach to calendar grid */
            padding: 0; /* Keep padding 0 */
            width: 100%;
            box-sizing: border-box;
            display: block; /* Override any grid display on the container itself */
        }

        #monthlySummary .monthly-report-stats.card {
            width: 100%;
            padding: 0;
            margin: 0;
            background-color: transparent;
            box-shadow: none;
            border: none;
            display: grid; /* Use grid layout */
            grid-template-columns: 1fr 1fr; /* Create exactly two equal columns */
            gap: 0.5rem; /* Add spacing between grid items */
        }

        #monthlySummary .monthly-report-stats.card .monthly-stat-item {
            padding: 0.75rem 0.5rem;
            margin: 0;
            border-radius: var(--border-radius-medium);
            /* Ensure text alignment is centered or as desired */
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        /* --- End Calendar Summary Styles --- */

        /* Toast / Message - Material Design 3 Style */
        #toast-container {
            position: fixed;
            bottom: 90px; /* Above bottom nav */
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000; /* Aumentato per essere sopra l'overlay del supereroe */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            width: 90%;
            max-width: 400px;
            pointer-events: none; /* Permette di cliccare attraverso il container */
        }
        .message, .toast {
            padding: 14px 16px;
            border-radius: 4px;
            background-color: var(--md-sys-color-inverse-surface);
            color: var(--md-sys-color-inverse-on-surface);
            box-shadow: var(--elevation-3);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.875rem;
            font-weight: 400;
            line-height: 1.25rem;
            letter-spacing: 0.0178571429em;
            pointer-events: auto; /* Permette interazione con il toast */
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 48px;
            box-sizing: border-box;
            border-left: 4px solid transparent;
            text-align: left;
        }
        .message.show, .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast-message {
            flex: 1;
            padding-right: 8px;
        }
        .toast-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 4px;
        }
        .toast-action-button {
            text-transform: uppercase;
            font-weight: 500;
            font-size: 0.75rem;
            letter-spacing: 0.0892857143em;
            padding: 8px 12px;
            border-radius: 4px;
            border: none;
            background: transparent;
            color: var(--md-sys-color-primary);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .toast-action-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .toast-close-button {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            color: var(--md-sys-color-inverse-on-surface);
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0;
            margin-left: 8px;
            transition: background-color 0.2s;
        }
        .toast-close-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        /* Toast types with left border */
        .message.success, .toast.success {
            border-left-color: var(--md-sys-color-tertiary);
        }
        .message.error, .toast.error {
            border-left-color: var(--md-sys-color-error);
        }
        .toast.warning {
            border-left-color: #FFA000;
            background-color: var(--md-sys-color-inverse-surface);
            color: var(--md-sys-color-inverse-on-surface);
        }
        .toast.info {
            border-left-color: var(--md-sys-color-primary);
            background-color: var(--md-sys-color-inverse-surface);
            color: var(--md-sys-color-inverse-on-surface);
        }

        /* Stili per la sezione Backup Cloud */
        .cloud-backup-container {
            margin-top: 1rem;
        }

        .provider-description {
            margin-bottom: 1rem;
            color: var(--md-sys-color-on-surface-variant);
            font-size: 0.9rem;
        }

        .provider-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .provider-option {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-radius: var(--border-radius-medium);
            background-color: var(--md-sys-color-surface-variant);
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        .provider-option:hover {
            background-color: var(--md-sys-color-primary-container);
            transform: translateY(-2px);
            box-shadow: var(--elevation-2);
        }

        .provider-option.selected {
            background-color: var(--md-sys-color-primary-container);
            border: 2px solid var(--md-sys-color-primary);
        }

        .provider-logo {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            flex-shrink: 0;
            background-color: white;
            border-radius: 50%;
            padding: 5px;
        }

        .provider-logo img {
            max-width: 100%;
            max-height: 100%;
        }

        .provider-info {
            flex-grow: 1;
        }

        .provider-info h4 {
            margin: 0 0 0.25rem 0;
            color: var(--md-sys-color-on-surface);
            font-size: 1rem;
        }

        .provider-info p {
            margin: 0;
            font-size: 0.85rem;
            color: var(--md-sys-color-on-surface-variant);
        }

        .provider-status {
            margin-left: 1rem;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--md-sys-color-outline);
        }

        .status-indicator.logged-in {
            background-color: #4CAF50; /* Verde */
        }

        .status-indicator.preferred {
            background-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 2px var(--md-sys-color-primary-container);
        }

        .cloud-account-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--md-sys-color-outline-variant);
        }

        .cloud-account-info {
            margin-bottom: 1rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            margin-right: 1rem;
            object-fit: cover;
            border: 2px solid var(--md-sys-color-primary);
        }

        .user-avatar-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            margin-right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-primary);
            border: 2px solid var(--md-sys-color-primary);
        }

        .user-details {
            flex-grow: 1;
        }

        .user-name {
            font-weight: 500;
            color: var(--md-sys-color-on-surface);
        }

        .user-email {
            font-size: 0.85rem;
            color: var(--md-sys-color-on-surface-variant);
        }

        .user-provider {
            font-size: 0.8rem;
            color: var(--md-sys-color-on-surface-variant);
            margin-top: 0.25rem;
        }

        .login-buttons-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .cloud-login-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius-full);
            border: none;
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: var(--elevation-1);
        }

        .cloud-login-btn:hover {
            box-shadow: var(--elevation-2);
        }

        .cloud-login-btn:active {
            transform: scale(0.98);
        }

        .cloud-login-btn img {
            width: 24px;
            height: 24px;
        }

        .cloud-login-btn.google-btn {
            background-color: #ffffff;
            color: #757575;
            border: 1px solid #dadce0;
        }

        .cloud-logout-btn {
            margin-top: 1rem;
            background-color: var(--md-sys-color-error-container);
            color: var(--md-sys-color-on-error-container);
        }

        .cloud-backup-controls {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--md-sys-color-outline-variant);
        }

        .backup-status-container {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.5rem;
            background-color: var(--md-sys-color-surface);
            border-radius: var(--border-radius-small);
        }

        .backup-status-label {
            font-weight: 500;
            margin-right: 0.5rem;
        }

        .backup-status-value {
            color: var(--md-sys-color-on-surface-variant);
        }

        .backup-actions {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .backup-btn {
            flex: 1;
            min-width: 120px;
        }

        .backup-settings {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .backup-setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .backup-setting-label {
            font-weight: 500;
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Monthly Report */
        .monthly-report-container { margin-top: 1.5rem; }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
            flex-wrap: wrap; /* Wrap on small screens */
            gap: 1rem;
        }
        .section-header h2 { margin: 0; flex-grow: 1; } /* Allow title to grow */
        .section-controls { display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap;}
        .month-selector select { /* Using standard input style */
            min-width: 150px; /* Ensure dropdown is usable */
        }

        .export-btn.excel-btn {
            background-color: #1D6F42; /* Excel Green */
            color: white;
        }
        .export-btn.excel-btn:hover { background-color: #165231; }

        .export-btn.pdf-btn {
            background-color: #D93025; /* PDF Red */
            color: white;
        }
        .export-btn.pdf-btn:hover { background-color: #B3261E; }

        .monthly-report-content { max-height: 60vh; overflow-y: auto; }
        .monthly-report-item {
            padding: 1rem;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
            transition: background-color 0.2s;
        }
        .monthly-report-item:last-child { border-bottom: none; }
        .monthly-report-item:hover { background-color: var(--md-sys-color-surface-variant); }
        .monthly-report-date {
            font-weight: 500;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--md-sys-color-primary);
        }
        .monthly-report-details { display: flex; flex-wrap: wrap; gap: 0.75rem; margin-bottom: 0.5rem; }
        .monthly-report-detail {
            background-color: var(--md-sys-color-surface);
            padding: 3px 8px;
            border-radius: var(--border-radius-small);
            font-size: 0.8rem;
            color: var(--md-sys-color-on-surface-variant);
            display: inline-flex; /* Align icon and text */
            align-items: center;
            gap: 4px;
        }
        .monthly-report-detail .material-symbols-outlined { font-size: 1.1em; }

        .monthly-report-description, .monthly-report-vehicle {
            font-size: 0.9rem;
            color: var(--md-sys-color-on-surface-variant);
            margin-top: 0.25rem;
        }
        .monthly-report-vehicle {
             padding-left: 8px;
             border-left: 2px solid var(--md-sys-color-outline);
             display: inline-flex; /* Align icon */
             align-items: center;
             gap: 4px;
        }
         .monthly-report-vehicle .material-symbols-outlined { font-size: 1em; }
        .monthly-report-empty { text-align: center; padding: 2rem; color: var(--md-sys-color-on-surface-variant); }

        /* Stile per la sezione dei file Excel esportati */
        .excel-files-section {
            margin-bottom: 1.5rem;
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: var(--border-radius-medium);
            overflow: hidden;
            background-color: var(--md-sys-color-surface);
        }

        .excel-files-header {
            width: 100%;
        }

        .toggle-excel-files {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 0.75rem 1rem;
            background-color: var(--md-sys-color-surface-variant);
            border: none;
            cursor: pointer;
            text-align: left;
            transition: background-color 0.2s;
        }

        .toggle-excel-files:hover {
            background-color: rgba(0, 106, 106, 0.1);
        }

        .toggle-excel-files h3 {
            color: var(--md-sys-color-primary);
            margin: 0;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .toggle-icon {
            margin-right: 0.5rem;
            transition: transform 0.3s ease;
            color: var(--md-sys-color-primary);
        }

        /* Rimuoviamo questa regola che potrebbe causare problemi */
        /* .toggle-excel-files[aria-expanded="true"] .toggle-icon {
            transform: rotate(180deg);
        } */

        .excel-files-container {
            max-height: 300px;
            overflow-y: auto;
            transition: max-height 0.3s ease, padding 0.3s ease, opacity 0.3s ease;
            padding: 1rem;
            opacity: 1;
        }

        .excel-files-container.collapsed {
            max-height: 0;
            padding: 0 1rem;
            overflow: hidden;
            opacity: 0;
        }

        .excel-files-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .excel-file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background-color: var(--md-sys-color-surface-variant);
            border-radius: var(--border-radius-medium);
            border: 1px solid var(--md-sys-color-outline-variant);
        }

        .excel-file-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .excel-file-icon {
            color: #165231; /* Verde Excel */
            font-size: 1.5rem;
        }

        .excel-file-details {
            display: flex;
            flex-direction: column;
        }

        .excel-file-name {
            font-weight: 500;
            color: var(--md-sys-color-on-surface);
        }

        .excel-file-date {
            font-size: 0.8rem;
            color: var(--md-sys-color-on-surface-variant);
        }

        .excel-file-actions {
            display: flex;
            gap: 0.5rem;
        }

        .excel-file-download, .excel-file-delete {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: var(--border-radius-small);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--md-sys-color-on-surface-variant);
            transition: background-color 0.2s, color 0.2s;
        }

        .excel-file-download:hover {
            background-color: rgba(0, 106, 106, 0.1);
            color: var(--md-sys-color-primary);
        }

        .excel-file-delete:hover {
            background-color: rgba(186, 26, 26, 0.1);
            color: var(--md-sys-color-error);
        }

        .empty-list-message {
            padding: 1rem;
            text-align: center;
            color: var(--md-sys-color-on-surface-variant);
            font-style: italic;
        }

        /* Style Ferie/Malattia in report */
         .monthly-report-item.ferie-entry {
             background-color: var(--md-sys-color-tertiary-container);
             color: var(--md-sys-color-on-tertiary-container);
             border-left: 3px solid var(--md-sys-color-tertiary);
             padding-left: calc(1rem - 3px); /* Adjust padding */
         }
          .monthly-report-item.ferie-entry .monthly-report-date { color: var(--md-sys-color-tertiary); }
          .monthly-report-item.ferie-entry .monthly-report-detail { background-color: var(--md-sys-color-surface); color: var(--md-sys-color-on-surface-variant); } /* Reset detail color */
          .monthly-report-item.ferie-entry .monthly-report-description { color: var(--md-sys-color-on-tertiary-container); opacity: 0.9; }

         .monthly-report-item.malattia-entry {
             background-color: var(--md-sys-color-secondary-container);
             color: var(--md-sys-color-on-secondary-container);
             border-left: 3px solid var(--md-sys-color-secondary);
             padding-left: calc(1rem - 3px);
         }
         .monthly-report-item.malattia-entry .monthly-report-date { color: var(--md-sys-color-secondary); }
         .monthly-report-item.malattia-entry .monthly-report-detail { background-color: var(--md-sys-color-surface); color: var(--md-sys-color-on-surface-variant); }
         .monthly-report-item.malattia-entry .monthly-report-description { color: var(--md-sys-color-on-secondary-container); opacity: 0.9; }


         /* Ferie/Malattie Section */
        .ferie-malattie-content { display: flex; flex-direction: column; gap: 1.5rem; }
        .ferie-malattie-form, .ferie-malattie-list {
             background-color: var(--md-sys-color-surface);
             padding: 1.5rem;
             border-radius: var(--border-radius-medium);
             border: 1px solid var(--md-sys-color-outline-variant);
        }
         .ferie-malattie-list h3 {
             color: var(--md-sys-color-secondary);
             margin-bottom: 1rem;
             font-weight: 500;
         }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
             color: var(--md-sys-color-on-surface);
             margin-bottom: 1rem; /* Consistent margin */
             padding: 0.5rem 0; /* Make easier to tap */
        }
        .checkbox-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--md-sys-color-primary); /* Style checkbox */
            margin: 0;
             flex-shrink: 0;
        }
         .checkbox-label span {
             line-height: 1.2;
         }

        .ferie-malattie-entry {
            padding: 1rem 0;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }
         .ferie-malattie-entry:last-child { border-bottom: none; margin-bottom: 0; }
         .ferie-malattie-info { flex-grow: 1; }
         .ferie-malattie-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem; flex-wrap: wrap; gap: 0.5rem; }
         .ferie-malattie-type { font-weight: 500; color: var(--md-sys-color-primary); display: inline-flex; align-items: center; gap: 0.25rem; }
         .ferie-malattie-type .material-symbols-outlined { font-size: 1.1em; vertical-align: bottom;}
         .ferie-malattie-date { color: var(--md-sys-color-on-surface-variant); font-size: 0.9rem; }
         .ferie-malattie-note { color: var(--md-sys-color-on-surface-variant); font-style: italic; font-size: 0.9rem; margin-top: 0.25rem; width: 100%; } /* Take full width below */
         .ferie-malattie-actions { flex-shrink: 0; }
         .delete-ferie-btn { /* Using standard delete button style */
             min-width: 40px;
             min-height: 40px;
             padding: 0; /* Remove padding if just icon */
             display: inline-flex; /* Center icon */
             align-items: center;
             justify-content: center;
         }
         .delete-ferie-btn .material-symbols-outlined { font-size: 1.5rem; }


        /* Vehicles Management */
         .vehicles-manager { margin-top: 1rem; }
         .vehicles-form { margin-bottom: 1rem; }
         .vehicles-form input { margin-bottom: 0; } /* Remove bottom margin if inside flex */
         .vehicles-list {
             border: 1px solid var(--md-sys-color-outline-variant);
             border-radius: var(--border-radius-medium);
             padding: 0.5rem;
             background-color: var(--md-sys-color-surface-variant);
             margin-top: 1rem;
             max-height: 200px;
             overflow-y: auto;
         }
         .vehicle-item {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 0.75rem 1rem;
             margin-bottom: 0.5rem;
             background-color: var(--md-sys-color-surface);
             border-radius: var(--border-radius-small);
             border: 1px solid var(--md-sys-color-outline-variant);
             gap: 1rem; /* Add gap */
         }
         .vehicle-item:last-child { margin-bottom: 0; }
         .vehicle-info { display: flex; flex-direction: column; flex-grow: 1; }
         .vehicle-name { font-weight: 500; color: var(--md-sys-color-on-surface); }
         .vehicle-plate { font-size: 0.8rem; color: var(--md-sys-color-on-surface-variant); }
         .delete-vehicle-btn { /* Using standard delete button style */
              min-width: 40px;
             min-height: 40px;
             padding: 0;
              display: inline-flex; /* Center icon */
             align-items: center;
             justify-content: center;
             flex-shrink: 0;
         }
          .delete-vehicle-btn .material-symbols-outlined { font-size: 1.5rem; }

        /* Date Picker (Flatpickr) Customization */
        .flatpickr-calendar {
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            border-radius: var(--border-radius-medium);
            box-shadow: var(--elevation-3);
            border: 1px solid var(--md-sys-color-outline-variant);
            width: auto; /* Adjust width */
             font-family: var(--body-font-family); /* Ensure correct font */
        }
        .flatpickr-months .flatpickr-month {
            background-color: transparent !important;
            color: var(--md-sys-color-on-surface);
            fill: var(--md-sys-color-on-surface);
            height: 56px; /* Taller header */
             border-radius: var(--border-radius-medium) var(--border-radius-medium) 0 0;
        }
        .flatpickr-months .flatpickr-prev-month, .flatpickr-months .flatpickr-next-month {
            fill: var(--md-sys-color-on-surface);
             top: 16px; /* Adjust icon position */
             padding: 4px; /* Hit area */
             border-radius: 50%;
             transition: background-color 0.2s ease;
             background-color: transparent !important;
        }
        .flatpickr-months .flatpickr-prev-month:hover, .flatpickr-months .flatpickr-next-month:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }
        .dark-theme .flatpickr-months .flatpickr-prev-month:hover, .dark-theme .flatpickr-months .flatpickr-next-month:hover {
             background-color: rgba(255, 255, 255, 0.1);
        }
        .flatpickr-current-month {
            font-size: 1.1rem;
            font-weight: 500;
            padding-top: 16px;
             height: 56px;
             display: flex;
             align-items: center;
             justify-content: center;
        }
        .flatpickr-current-month .flatpickr-monthDropdown-months,
        .flatpickr-current-month input.cur-year {
            background-color: transparent !important;
            color: var(--md-sys-color-on-surface) !important;
            border: none;
            font-weight: 500;
             padding: 2px 4px;
             border-radius: var(--border-radius-small);
        }
         .flatpickr-current-month .flatpickr-monthDropdown-months:hover,
        .flatpickr-current-month input.cur-year:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }
        .dark-theme .flatpickr-current-month .flatpickr-monthDropdown-months:hover,
        .dark-theme .flatpickr-current-month input.cur-year:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        span.flatpickr-weekday {
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            font-weight: 500;
             font-size: 0.8em;
             text-transform: uppercase;
             height: 36px;
             line-height: 36px;
        }
        .flatpickr-day {
            color: var(--md-sys-color-on-surface);
            border: 1px solid transparent;
            border-radius: var(--border-radius-full); /* Circular days */
            line-height: 36px; /* Adjust for circle */
            max-width: 38px;
            height: 38px;
             margin: 1px auto; /* Center circle */
             font-weight: 400;
             transition: all 0.2s ease;
        }
        .flatpickr-day:hover, .flatpickr-day:focus {
            background-color: var(--md-sys-color-surface-variant);
            border-color: var(--md-sys-color-surface-variant);
             color: var(--md-sys-color-on-surface-variant);
        }
        .flatpickr-day.today {
             position: relative;
             border: none;
             color: var(--md-sys-color-on-surface);
             background-color: transparent;
             font-weight: 700;
             z-index: 1;
        }

        /* Cerchio attorno al giorno corrente */
        .flatpickr-day.today::before {
             content: "";
             position: absolute;
             top: 50%;
             left: 50%;
             transform: translate(-50%, -50%);
             width: 36px;
             height: 36px;
             border-radius: 50%;
             border: 3px solid var(--md-sys-color-primary);
             background-color: rgba(0, 106, 106, 0.05); /* Colore primario con opacità molto bassa */
             z-index: -1;
             box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .flatpickr-day.selected, .flatpickr-day.startRange, .flatpickr-day.endRange,
        .flatpickr-day.selected:hover, .flatpickr-day.startRange:hover, .flatpickr-day.endRange:hover {
            background-color: var(--md-sys-color-primary);
            border-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
        }
        .flatpickr-day.inRange {
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            box-shadow: none;
            border-color: var(--md-sys-color-primary-container);
            border-radius: 0; /* Square in-range */
        }
        .flatpickr-day.startRange, .flatpickr-day.endRange {
            border-radius: var(--border-radius-full); /* Ensure start/end are round */
        }
        .flatpickr-day.disabled, .flatpickr-day.disabled:hover {
            color: var(--md-sys-color-on-surface-variant);
            opacity: 0.5;
            background-color: transparent;
            border-color: transparent;
            cursor: default;
        }


         /* Date indicator styling */
        #dateIndicator div {
            background-color: var(--md-sys-color-primary-container) !important;
            color: var(--md-sys-color-on-primary-container) !important;
            padding: 10px 15px !important;
            border-radius: var(--border-radius-medium) !important;
            margin: 10px 0 !important;
            font-size: 1.1rem !important;
            text-align: center;
            font-weight: 500 !important;
            cursor: pointer;
            box-shadow: var(--elevation-1);
            transition: background-color 0.2s ease, filter 0.2s ease;
             display: flex; /* Align icon and text */
             align-items: center;
             justify-content: center;
             gap: 0.5rem;
        }
         #dateIndicator div:hover {
             filter: brightness(95%);
         }
          .dark-theme #dateIndicator div:hover {
             filter: brightness(110%);
         }

        #dateIndicator .material-symbols-outlined {
             font-size: 1.2em;
         }
         #dateIndicator span {
             vertical-align: middle;
         }

         /* Hide original date input and label */
         #date { display: none !important; }
         label[for='date'] { display: none !important; }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .container { padding: 0.75rem; }
            main { padding: 0.75rem; margin-top: 65px; }
            .card { padding: 1rem; margin-bottom: 1rem; }
            .bottom-nav { padding: 0.25rem 0; }
            .nav-item { font-size: 0.65rem; min-height: 52px; padding: 0.25rem 0.5rem; }
            .nav-item .material-symbols-outlined { font-size: 1.5rem; }
            .nav-item.active .material-symbols-outlined { font-size: 1.7rem; }
            /* Removed .nav-item.active::before as requested */
            .nav-item::before { display: none; }
            .nav-item.active::after { height: 2px; }
            .form-row { flex-direction: column; gap: 0; } /* Stack inline groups */
            .form-group-inline { margin-bottom: 1rem; }

            .modal-content { width: 95%; margin: 5vh auto; padding: 1rem; }
            .modal-title { font-size: 1.25rem; }
            .day-summary-value { font-size: 1.5rem; }

            .calendar-day { min-height: 60px; padding: 4px; }
            .calendar-day-number { font-size: 0.75rem; width: 20px; height: 20px; line-height: 20px; top: 2px; left: 2px;}
            .calendar-day-content { margin-top: 24px; }
            .calendar-hours { font-size: 0.8rem; }
            .calendar-icons { font-size: 0.8rem; }
            .calendar-icons .material-symbols-outlined { font-size: 1em; }
            .calendar-holiday-name { font-size: 0.65rem; }
            .calendar-weekday { font-size: 0.7rem; padding: 0.5rem 0.1rem; }

            .monthly-summary, .stats-container, .monthly-report-stats { gap: 0.5rem; padding: 0.75rem; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); }
            .monthly-stat-item, .stat-card { min-width: auto; padding: 0.5rem; }
            .monthly-stat-value, .stat-value { font-size: 1.25rem; }
            .monthly-stat-label, .stat-label { font-size: 0.7rem; }

            .section-header { flex-direction: column; align-items: stretch; }
            .section-controls { justify-content: center; width: 100%; }
             .section-controls .month-selector { flex-grow: 1; } /* Allow selector to grow */
             .section-controls button { width: 100%; margin-top: 0.5rem; } /* Stack button */

            .vehicles-form div { flex-direction: column; gap: 0.5rem; align-items: stretch; }
            .vehicles-form input { margin-right: 0; }
            .vehicles-form button { width: 100%; margin-top: 0.5rem; }

            .setting-item { flex-direction: column; align-items: stretch; }
             .setting-item .setting-label { margin-bottom: 0.5rem; }
             .setting-item > div { width: 100%; } /* Make input+button full width */
             .setting-item > button { margin-top: 0.5rem; width: 100%; }
             .setting-item .toggle-switch { align-self: flex-end; margin-top: 0.5rem; } /* Align toggle right */
        }

        @media (max-width: 480px) {
             html { font-size: 14px; }
            .container { padding: 0.5rem; }
             main { padding: 0.5rem; margin-top: 60px; }
             .card { padding: 0.75rem; }
             button, .btn { padding: 0.6rem 1.2rem; font-size: 0.8rem; }
             .nav-item { font-size: 0.6rem; }
             .nav-item .material-symbols-outlined { font-size: 1.4rem; }
             .nav-item.active .material-symbols-outlined { font-size: 1.6rem; }
             /* Removed .nav-item.active::before as requested */
             .nav-item::before { display: none; }
             .nav-item.active { transform: translateY(-3px); }
             .logo img { max-height: 35px; }
             header { padding: 0.5rem 1rem; }
             #dateIndicator div { font-size: 1rem !important; }

             /* Stack time inputs */
             .time-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; } /* Keep side-by-side if possible */
             .time-row .form-group { margin-bottom: 0.5rem; }

             .day-summary { grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); gap: 0.5rem; padding: 0.5rem;}
             .day-summary-value { font-size: 1.2rem; }
             .day-summary-label { font-size: 0.7rem; }

             .monthly-summary, .stats-container, .monthly-report-stats { grid-template-columns: 1fr 1fr; } /* Two columns */
        }

        /* Specific styles for the monthly summary below the calendar */
        .monthly-summary {
            margin-top: 1rem; /* Add some space above the summary */
            padding: 1rem;
            background-color: var(--md-sys-color-surface-container-low);
            border-radius: var(--border-radius-large);
        }
        .monthly-summary h3 {
            text-align: center;
            margin-bottom: 1rem;
            font-weight: 500;
            color: var(--md-sys-color-on-surface);
        }
        .monthly-stats {
            display: grid; /* Ensure it's a grid container */
            grid-template-columns: 1fr 1fr; /* Create 2 columns */
            gap: 1rem; /* Add spacing between grid items */
        }
        .monthly-stat-item {
            background-color: var(--md-sys-color-surface-container);
            padding: 1rem;
            border-radius: var(--border-radius-medium);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .monthly-stat-value {
            font-size: 1.8rem; /* Slightly larger value */
            font-weight: 500;
            color: var(--md-sys-color-primary);
            margin-bottom: 0.25rem;
        }
        .dark-theme .monthly-stat-value {
             color: var(--md-sys-color-primary-dark);
        }
        .monthly-stat-label {
            font-size: 0.8rem;
            color: var(--md-sys-color-on-surface-variant);
            text-transform: uppercase;
        }

        /* Remove .monthly-summary from the media query rule if it only applied grid there */
        @media (max-width: 600px) {
            /* ... other rules ... */
             .stats-container, .monthly-report-stats { grid-template-columns: 1fr 1fr; } /* Keep other relevant selectors */
            /* Remove or comment out the old rule applying grid to .monthly-summary here */
             /* .monthly-summary, .stats-container, .monthly-report-stats { grid-template-columns: 1fr 1fr; } */
        }

        /* Remove or adjust old .monthly-stats rules */
        /* .monthly-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        } */

        /* Ensure the rule for .monthly-report-stats exists and is correct */
        /* This might already exist from the report section styling */
        .monthly-report-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem; /* Further reduced gap */
             /* background-color, padding, margin-bottom etc. are now handled by inline styles or .card */
        }

        /* Ensure styles for items, values, labels are consistent */
        /* These might already exist */
        .monthly-stat-item {
            /* background-color is now mostly inline or inherited from .card */
            padding: 1rem;
            border-radius: var(--border-radius-medium);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .monthly-stat-value {
            font-size: 1.8rem;
            font-weight: 500;
            /* color is now mostly inline or inherited */
            margin-bottom: 0.25rem;
        }
        .monthly-stat-label {
            font-size: 0.8rem;
            /* color is now mostly inline or inherited */
            text-transform: uppercase;
        }

        /* Adjust media query if needed */
        @media (max-width: 600px) {
            /* Ensure this applies correctly */
            .monthly-report-stats, .stats-container /* Keep other relevant selectors */ {
                 grid-template-columns: 1fr 1fr; /* Or maybe 1fr for very small screens? */
                 gap: 0.25rem; /* Further reduce gap on small screens */
            }
            /* Remove old .monthly-stats rule */
             /* .stats-container, .monthly-report-stats { grid-template-columns: 1fr 1fr; } */
        }

        /* ... rest of css ... */

        #calendar-section .card {
            padding: 1rem; /* Maintain padding for the overall card */
        }

        #monthlySummary {
            margin-top: 0; /* Remove top margin to attach to calendar grid */
            padding: 0; /* Keep padding 0 */
            /* Ensure it spans the width of its container (.card) */
            width: 100%;
            box-sizing: border-box; /* Include padding/border in width calculation if any were added later */
        }

        /* Style the summary stats specifically when inside the calendar summary container */
        #monthlySummary .monthly-report-stats.card {
            width: 100%;
            padding: 0; /* Remove padding from the inner card */
            margin: 0; /* Remove margin from the inner card */
            background-color: transparent; /* Optional: make background transparent if parent sets it */
            box-shadow: none; /* Optional: remove shadow if parent has border */
            border: none; /* Optional: remove border if parent has border */
            /* Ensure the grid items inside also behave */
            display: grid; /* Use grid like the original */
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); /* Adjust columns as needed */
            gap: 0.5rem; /* Maintain gap between items */
        }

        #monthlySummary .monthly-report-stats.card .monthly-stat-item {
            /* Adjust padding/margin for individual items if needed */
            padding: 0.75rem 0.5rem;
            margin: 0;
            border-radius: var(--border-radius-medium);
            /* Background color is already set, keep it */
        }

        /* ... rest of css ... */

        /* --- Calendar Summary Styles (Moved Here) --- */
        #monthlySummary {
            margin-top: 0; /* Remove top margin to attach to calendar grid */
            padding: 0; /* Keep padding 0 */
            width: 100%;
            box-sizing: border-box;
            display: block; /* Override any grid display on the container itself */
        }

        #monthlySummary .monthly-report-stats.card {
            width: 100%;
            padding: 0;
            margin: 0;
            background-color: transparent;
            box-shadow: none;
            border: none;
            display: grid; /* Use grid layout */
            grid-template-columns: 1fr 1fr; /* Create exactly two equal columns */
            gap: 0.5rem; /* Add spacing between grid items */
        }

        #monthlySummary .monthly-report-stats.card .monthly-stat-item {
            padding: 0.75rem 0.5rem;
            margin: 0;
            border-radius: var(--border-radius-medium);
            /* Ensure text alignment is centered or as desired */
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        /* --- End Calendar Summary Styles --- */

        /* --- Gratta e Vinci Styles --- */
        .scratch-card-btn {
            background-color: #FF6B00; /* Arancione brillante */
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
            animation: pulse-slow 3s infinite;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            box-shadow: 0 0 10px rgba(255, 107, 0, 0.5);
            margin-right: 10px;
            font-size: 0.9rem;
        }

        .scratch-card-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #FF6B00;
            background-color: #FF8C00;
        }

        @keyframes pulse-slow {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        #scratchCardOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        #scratchCardOverlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .scratch-card-container {
            position: relative;
            width: 300px;
            height: 200px;
            background-color: var(--md-sys-color-surface);
            border-radius: var(--border-radius-medium);
            box-shadow: var(--elevation-3);
            overflow: hidden;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        #scratchCardOverlay.visible .scratch-card-container {
            transform: scale(1);
        }

        .scratch-card-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
            color: var(--md-sys-color-on-surface);
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 1;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40"><text x="50%" y="50%" font-family="Arial" font-size="6" fill="%23cccccc" text-anchor="middle" dominant-baseline="middle">PWS</text></svg>');
            background-repeat: repeat;
        }

        .scratch-card-content p {
            background-color: var(--md-sys-color-surface);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .scratch-card-content span {
            color: var(--md-sys-color-primary);
            font-size: 1.5rem;
            margin-top: 10px;
            background-color: var(--md-sys-color-surface);
            padding: 10px;
            border-radius: 8px;
        }

        #scratchCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="12" fill="%23ffffff" stroke="%23000000" stroke-width="1" opacity="0.7"/><circle cx="16" cy="16" r="4" fill="%23000000" opacity="0.5"/></svg>') 16 16, auto;
            border-radius: var(--border-radius-medium);
            transition: opacity 0.5s ease;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .scratch-card-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            z-index: 3;
        }

        /* Fix per il menu contestuale su iOS */
        #pws-logo {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        #pws-logo img {
            pointer-events: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
    </style>
    <!-- Librerie esterne ottimizzate con attributi defer per migliorare il caricamento -->
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.3.0/dist/exceljs.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/it.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <!-- 🍎 iOS Datepicker Fix -->
    <script src="./ios-fix.js"></script>

    <!-- Ottimizzazioni CSS per Safari iOS -->
    <style>
        /* Ottimizzazioni per Safari iOS e cross-browser */
        * {
            -webkit-tap-highlight-color: transparent !important;
            -webkit-overflow-scrolling: touch !important;
        }

        /* Forza hardware acceleration per animazioni fluide */
        .bouncing-logo,
        .nav-item.active,
        .modal,
        .bottom-nav,
        .card,
        button,
        .btn {
            -webkit-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
        }

        /* Disabilita temporaneamente le animazioni durante lo scroll */
        .disable-animations * {
            -webkit-transition: none !important;
            transition: none !important;
            -webkit-animation: none !important;
            animation: none !important;
        }

        /* Ottimizzazioni per il rendering */
        .card,
        .modal-content,
        .bottom-nav,
        header {
            backface-visibility: hidden;
            perspective: 1000px;
        }

        /* Stili per la sezione Cash */
        .cash-settings-container {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
        }

        .cash-results-container {
            margin-top: 1.5rem;
        }

        .cash-results {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .cash-result-item {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 1rem;
            padding: 0.75rem 1rem;
            background-color: var(--md-sys-color-surface);
            border-radius: var(--border-radius-medium);
            align-items: center;
            transition: background-color 0.2s ease;
        }

        .cash-result-item:hover {
            background-color: var(--md-sys-color-surface-variant);
        }

        .cash-result-label {
            font-weight: 500;
            color: var(--md-sys-color-on-surface);
        }

        .cash-result-hours {
            font-family: monospace;
            font-size: 0.9rem;
            color: var(--md-sys-color-on-surface-variant);
            text-align: right;
        }

        .cash-result-amount {
            font-family: monospace;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--md-sys-color-primary);
            text-align: right;
            min-width: 80px;
        }

        .cash-result-total {
            margin-top: 0.5rem;
            background-color: var(--md-sys-color-primary-container);
            border-left: 3px solid var(--md-sys-color-primary);
        }

        .cash-result-total .cash-result-label {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--md-sys-color-on-primary-container);
        }

        .cash-result-total .cash-result-amount {
            font-size: 1.3rem;
            color: var(--md-sys-color-on-primary-container);
        }

        @media (max-width: 600px) {
            .cash-result-item {
                padding: 0.5rem 0.75rem;
                gap: 0.5rem;
            }

            .cash-result-label {
                font-size: 0.9rem;
            }

            .cash-result-hours {
                font-size: 0.8rem;
            }

            .cash-result-amount {
                font-size: 1rem;
                min-width: 70px;
            }

            .cash-result-total .cash-result-label,
            .cash-result-total .cash-result-amount {
                font-size: 1.1rem;
            }
        }

        /* Ottimizzazioni per input e form */
        input,
        select,
        textarea {
            -webkit-appearance: none;
            appearance: none;
            border-radius: 0;
        }

        /* Previeni zoom involontario su input */
        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="tel"],
        textarea,
        select {
            font-size: 16px !important;
        }

        /* Migliora la reattività dei pulsanti */
        button, .btn {
            touch-action: manipulation;
        }

        /* Ottimizzazioni per il rendering delle liste */
        .time-entries-list > div,
        .monthly-report-item,
        .vehicle-item {
            will-change: transform, opacity;
            transform: translateZ(0);
        }

        /* Ottimizzazioni per il calendario */
        .calendar-day {
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }

        /* Ottimizzazioni per le transizioni */
        .section.active {
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }

        /* Ottimizzazioni per il modal */
        .modal {
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }

        /* Ottimizzazioni per il toast */
        .toast {
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }

        /* Ottimizzazioni per le animazioni di fade */
        @media (-webkit-min-device-pixel-ratio: 2) {
            @keyframes fadeIn {
                0% { opacity: 0; transform: translateY(0); }
                100% { opacity: 1; transform: translateY(0); }
            }

            @keyframes fadeOut {
                0% { opacity: 1; transform: translateY(0); }
                100% { opacity: 0; transform: translateY(0); }
            }

            /* Semplifica le animazioni su dispositivi iOS */
            @keyframes bounce-horizontal {
                0%, 100% {
                    transform: translateX(0);
                }
                50% {
                    transform: translateX(10px);
                }
            }

            @keyframes bounce-excited {
                0%, 100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.2);
                }
            }

            .bouncing-logo {
                animation-duration: 3s !important;
            }

            .bouncing-logo-excited {
                animation-duration: 1.5s !important;
            }
        }
    </style>
    <!-- Custom Navigation Styles (inline) -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Create a style element
        const styleElement = document.createElement('style');

        // Add our new navigation styles
        styleElement.textContent = `
            /* Modern Bottom Navigation Redesign */
            .bottom-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                background-color: var(--md-sys-color-surface);
                box-shadow: var(--elevation-2);
                padding: 0.75rem 0;
                display: flex;
                justify-content: space-around;
                align-items: center;
                z-index: 1000;
                border-top-left-radius: 16px;
                border-top-right-radius: 16px;
            }

            .nav-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                text-decoration: none;
                color: var(--md-sys-color-on-surface-variant);
                font-size: 0.75rem;
                padding: 0.5rem 0.75rem;
                border-radius: var(--border-radius-full);
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                flex: 1;
                text-align: center;
                min-height: 56px;
                position: relative;
                overflow: visible;
            }

            .nav-item .material-symbols-outlined {
                font-size: 1.75rem;
                margin-bottom: 4px;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .nav-item span {
                display: block;
                line-height: 1.2;
                white-space: nowrap;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                opacity: 0.9;
            }

            .nav-item.active {
                color: var(--md-sys-color-primary);
                font-weight: 500;
                transform: translateY(-8px);
            }

            .nav-item.active .material-symbols-outlined {
                font-variation-settings: 'FILL' 1, 'wght' 600;
                font-size: 2rem;
                filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
            }

            /* Remove the ::before element as requested */
            .nav-item.active::before {
                display: none !important;
            }

            .nav-item::before {
                display: none !important;
            }

            /* Bordo inferiore per l'elemento attivo */
            .nav-item.active::after {
                content: '';
                display: block;
                width: 50%;
                height: 4px;
                background-color: var(--md-sys-color-primary);
                border-radius: var(--border-radius-full);
                position: absolute;
                bottom: -8px;
                left: 50%;
                transform: translateX(-50%);
                transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            /* Hover effect */
            .nav-item:hover {
                color: var(--md-sys-color-on-surface);
                background-color: rgba(0, 106, 106, 0.08);
                transform: translateY(-2px);
            }

            .nav-item:active {
                transform: scale(0.95);
            }

            /* Media queries for responsive design */
            @media (max-width: 768px) {
                .bottom-nav { padding: 0.25rem 0; }
                .nav-item { font-size: 0.65rem; min-height: 52px; padding: 0.25rem 0.5rem; }
                .nav-item .material-symbols-outlined { font-size: 1.5rem; }
                .nav-item.active .material-symbols-outlined { font-size: 1.7rem; }
                .nav-item.active::after { height: 3px; }
            }

            @media (max-width: 480px) {
                .nav-item { font-size: 0.6rem; }
                .nav-item .material-symbols-outlined { font-size: 1.4rem; }
                .nav-item.active .material-symbols-outlined { font-size: 1.6rem; }
                .nav-item.active { transform: translateY(-6px); }
            }
        `;

        // Add the style element to the head
        document.head.appendChild(styleElement);
    });
    </script>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo bouncing-logo" id="pws-logo">
                <img src="https://i.imgur.com/BnllByD.png"
                     alt="PWS Logo"
                     draggable="false"
                     style="pointer-events: none; /* Impedisce che l'immagine riceva eventi touch/click */"
                     >
            </div>
            <div class="header-actions">
                <!-- Pulsante Gratta e Vinci -->
                <button id="scratchCardBtn" class="btn scratch-card-btn">
                    <span class="material-symbols-outlined">redeem</span>
                    Gratta e Vinci
                </button>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <!-- Sezione Home -->
            <div id="home-section" class="section active">
                <div class="card">
                    <h2>Inserisci Ore</h2>
                    <div class="form-container">
                        <form id="timeEntryForm">
                            <div class="form-group">
                                <!-- Label hidden via CSS, Date indicator shown below -->
                                <label for="date">Data:</label>
                                <input type="text" id="date" class="form-control datepicker" required>
                                <div id="dateIndicator" title="Clicca per cambiare data">
                                    <!-- Indicator content set by JS -->
                                    <div>
                                        <span class="material-symbols-outlined">calendar_today</span>
                                        <span>Seleziona una data</span>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="vehicleSelect">Mezzo:</label>
                                <select id="vehicleSelect" class="form-control">
                                    <option value="">-- Seleziona un mezzo --</option>
                                    <!-- Dynamic options -->
                                </select>
                            </div>

                            <div class="time-row">
                                <div class="form-group">
                                    <label for="startTime">Ora Inizio:</label>
                                    <div class="time-input-container">
                                        <button type="button" class="time-control-btn" data-action="decrease" data-target="startTime">
                                            <span class="material-symbols-outlined">arrow_left</span>
                                        </button>
                                        <input type="text" id="startTime" class="form-control time-input" placeholder="Es. 7" value="7">
                                        <button type="button" class="time-control-btn" data-action="increase" data-target="startTime">
                                            <span class="material-symbols-outlined">arrow_right</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="endTime">Ora Fine:</label>
                                    <div class="time-input-container">
                                        <button type="button" class="time-control-btn" data-action="decrease" data-target="endTime">
                                            <span class="material-symbols-outlined">arrow_left</span>
                                        </button>
                                        <input type="text" id="endTime" class="form-control time-input" placeholder="Es. 16.5" value="16.5">
                                        <button type="button" class="time-control-btn" data-action="increase" data-target="endTime">
                                            <span class="material-symbols-outlined">arrow_right</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="breakTime">Pausa (ore):</label>
                                <div class="time-input-container">
                                    <button type="button" class="time-control-btn" data-action="decrease" data-target="breakTime">
                                        <span class="material-symbols-outlined">arrow_left</span>
                                    </button>
                                    <input type="text" id="breakTime" class="form-control compact-input" value="0.5">
                                    <button type="button" class="time-control-btn" data-action="increase" data-target="breakTime">
                                        <span class="material-symbols-outlined">arrow_right</span>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="notturne">Ore Notturne:</label>
                                <input type="number" id="notturne" class="form-control compact-input" step="0.5" min="0">
                            </div>

                            <div class="form-group">
                                <label for="transferta">Trasferta:</label>
                                <button type="button" id="transferta" class="trasferta-button">
                                    <span class="material-symbols-outlined">local_shipping</span>
                                    <span class="trasferta-text">Seleziona trasferta</span>
                                </button>
                            </div>

                            <div class="form-group">
                                <label for="totalHours">Ore Totali:</label>
                                <input type="number" id="totalHours" class="form-control compact-input" readonly>
                            </div>

                            <div class="form-group">
                                <label for="work-descriptions">Lavoro:</label>
                                <div id="work-descriptions-container">
                                    <div class="work-description-row">
                                        <input type="text" id="description" class="form-control work-description-input" placeholder="Inserisci un lavoro" data-row="0">
                                    </div>
                                </div>
                                <button type="button" id="add-work-row" class="btn-add-work">
                                    <span class="material-symbols-outlined">add</span> Aggiungi riga(oppure premi invio)
                                </button>
                            </div>

                            <div class="form-group" style="margin-top: 20px; text-align: right;">
                                <button type="submit" id="submitBtn">
                                    <span class="material-symbols-outlined">save</span> Salva
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <h2>Ultime Entrate</h2>
                    <div id="timeEntries">
                        <!-- Dynamic content -->
                    </div>
                </div>
            </div>

            <!-- Sezione Calendario -->
            <div id="calendar-section" class="section">
                <div class="card">
                    <h2>Calendario</h2>
                    <div class="calendar-container" id="calendarEntries">
                         <!-- Calendar generated by JS -->
                    </div>
                    <!-- Container for the summary, content now generated by JS -->
                    <div class="monthly-summary" id="monthlySummary" style="margin-top: 1rem; padding: 0;">
                        <!-- Content will be injected by updateMonthlySummary -->
                        <!-- Ensure all previous inner divs like .monthly-report-stats are removed -->
                            </div>
                </div>
            </div>

            <!-- Sezione Impostazioni -->
            <div id="settings-section" class="section">
                <div class="card">
                    <h2>Impostazioni</h2>
                    <div class="settings-container">
                        <div class="setting-item">
                            <span class="setting-label">Tema Scuro</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="darkTheme">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label for="userName" class="setting-label">Nome Utente</label>
                            <div style="display: flex; gap: 10px; flex-grow: 1;">
                                <input type="text" id="userName" class="settings-input" placeholder="Inserisci il tuo nome">
                                <button id="saveUserName">
                                    <span class="material-symbols-outlined">save</span> Salva
                                </button>
                            </div>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">Esporta Dati</span>
                            <button id="exportData">
                                <span class="material-symbols-outlined">download</span> Esporta Dati
                            </button>
                        </div>
                         <div class="setting-item">
                            <span class="setting-label">Importa Dati</span>
                            <button id="importData">
                                <span class="material-symbols-outlined">upload</span> Importa Dati
                            </button>
                        </div>

                        <div class="setting-item">
                            <span class="setting-label">Aggiorna App</span>
                            <button id="forceUpdate">
                                <span class="material-symbols-outlined">refresh</span> Forza Aggiornamento!
                            </button>
                        </div>

                        <div class="setting-item">
                            <span class="setting-label">PIN Admin</span>
                            <div style="display: flex; gap: 10px; flex-grow: 1;">
                                <input type="password" id="adminPin" class="settings-input" placeholder="Inserisci PIN Admin" maxlength="7">
                                <button id="unlockAdminFeatures">
                                    <span class="material-symbols-outlined">lock_open</span> Sblocca
                                </button>
                                <button id="lockAdminFeatures" style="display: none;">
                                    <span class="material-symbols-outlined">lock</span> Blocca
                                </button>
                            </div>
                        </div>

                        <div class="setting-item" style="flex-direction: column; align-items: stretch;">
                            <span class="setting-label">Installa App</span>

                            <!-- Pulsante per Android e desktop -->
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <button id="installPwa" class="install-button" style="display: none; margin-right: 10px; background-color: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); font-weight: bold; padding: 12px 20px;">
                                    <span class="material-symbols-outlined">download_for_offline</span> Installa App
                                </button>
                                <span id="pwaStatus" style="font-size: 0.9rem; color: var(--md-sys-color-on-surface-variant);">
                                    Verifica disponibilità...
                                </span>
                            </div>

                            <!-- Pulsante di installazione alternativo (più visibile) -->
                            <div class="card" style="margin-top: 15px; background-color: var(--md-sys-color-primary-container); display: none;" id="installCardPrompt">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div>
                                        <h3 style="color: var(--md-sys-color-on-primary-container); margin-bottom: 5px;">Installa l'app Ore PWS</h3>
                                        <p style="color: var(--md-sys-color-on-primary-container); margin-bottom: 0;">Usa l'app anche offline e accedi più velocemente!</p>
                                    </div>
                                    <button class="install-button" style="background-color: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); font-weight: bold;">
                                        <span class="material-symbols-outlined">download_for_offline</span> Installa
                                    </button>
                                </div>
                            </div>

                            <!-- Istruzioni per iOS (inizialmente nascos